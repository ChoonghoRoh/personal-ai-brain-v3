<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/static/css/admin/admin-styles.css" />
    <link rel="stylesheet" href="/static/css/statistics.css" />
    <script src="/static/libs/chartjs/chart.min.js"></script>
    <title>Personal AI Brain - 통계 대시보드</title>
  </head>
  <body>
    <div class="container">
      <div id="header-placeholder"></div>

      <div id="error-message" class="error" style="display: none"></div>
      <div id="success-message" class="success" style="display: none"></div>

      <!-- Main Content -->
      <div class="admin-container">
        <div class="page-header">
          <h3>Statistics Dashboard</h3>
          <p class="page-description">시스템 현황 및 사용량 통계</p>
          <button id="refreshBtn" class="btn btn-secondary" onclick="loadAllStatistics()">
            <span class="icon">↻</span> 새로고침
          </button>
        </div>

        <!-- Phase 17-6: 1단 — 요약 수치 -->
        <section class="stats-tier">
          <div class="tier-header">
            <h3 class="tier-subtitle">요약</h3>
          </div>
        <div class="summary-cards">
          <div class="card summary-card" id="cardDocuments" data-category="documents">
            <div class="card-icon">📄</div>
            <div class="card-content">
              <div class="card-value" id="totalDocuments">-</div>
              <div class="card-label">총 문서</div>
              <div class="card-sub" id="recentDocuments">최근 7일: -</div>
            </div>
          </div>

          <div class="card summary-card" id="cardChunks" data-category="chunks">
            <div class="card-icon">🧩</div>
            <div class="card-content">
              <div class="card-value" id="totalChunks">-</div>
              <div class="card-label">총 청크</div>
              <div class="card-sub" id="approvedChunks">승인됨: -</div>
            </div>
          </div>

          <div class="card summary-card" id="cardLabels" data-category="labels">
            <div class="card-icon">🏷️</div>
            <div class="card-content">
              <div class="card-value" id="totalLabels">-</div>
              <div class="card-label">총 라벨</div>
              <div class="card-sub" id="totalProjects">프로젝트: -</div>
            </div>
          </div>

          <div class="card summary-card" id="cardUsage" data-category="usage">
            <div class="card-icon">📊</div>
            <div class="card-content">
              <div class="card-value" id="todayUsage">-</div>
              <div class="card-label">오늘 사용</div>
              <div class="card-sub" id="totalReasoning">총 추론: -</div>
            </div>
          </div>
        </div>

        </section><!-- /stats-tier 1단 -->

        <!-- Phase 17-6: 2단 — 분포 차트 -->
        <section class="stats-tier">
          <div class="tier-header">
            <h3 class="tier-subtitle">분포 현황</h3>
          </div>
        <div class="charts-row">
          <div class="card chart-card">
            <h3>문서 유형 분포</h3>
            <div class="chart-container">
              <canvas id="docTypeChart"></canvas>
            </div>
          </div>

          <div class="card chart-card">
            <h3>청크 상태 분포</h3>
            <div class="chart-container">
              <canvas id="chunkStatusChart"></canvas>
            </div>
          </div>

          <div class="card chart-card">
            <h3>라벨 유형 분포</h3>
            <div class="chart-container">
              <canvas id="labelTypeChart"></canvas>
            </div>
          </div>
        </div>

        </section><!-- /stats-tier 2단 -->

        <!-- Phase 17-6: 3단 — 트렌드 -->
        <section class="stats-tier">
          <div class="tier-header">
            <h3 class="tier-subtitle">일일 트렌드</h3>
          </div>
        <div class="trends-section">
          <div class="card">
            <div class="card-header">
              <h3>일별 트렌드 (최근 7일)</h3>
              <select id="trendDays" onchange="loadTrends()">
                <option value="7">7일</option>
                <option value="14">14일</option>
                <option value="30">30일</option>
              </select>
            </div>
            <div class="chart-container-wide">
              <canvas id="trendsChart"></canvas>
            </div>
          </div>
        </div>

        </section><!-- /stats-tier 3단 -->

        <!-- Phase 17-6: 4단 — 상세 테이블 -->
        <section class="stats-tier">
          <div class="tier-header">
            <h3 class="tier-subtitle">상세 현황</h3>
          </div>
        <div class="details-section">
          <div class="card">
            <h3>인기 라벨 TOP 10</h3>
            <div class="table-container">
              <table id="topLabelsTable">
                <thead>
                  <tr>
                    <th>순위</th>
                    <th>라벨</th>
                    <th>유형</th>
                    <th>사용 횟수</th>
                  </tr>
                </thead>
                <tbody id="topLabelsBody">
                  <tr><td colspan="4" class="loading">로딩 중...</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="card">
            <h3>프로젝트별 현황</h3>
            <div class="table-container">
              <table id="projectsTable">
                <thead>
                  <tr>
                    <th>프로젝트</th>
                    <th>문서 수</th>
                    <th>청크 수</th>
                  </tr>
                </thead>
                <tbody id="projectsBody">
                  <tr><td colspan="3" class="loading">로딩 중...</td></tr>
                </tbody>
              </table>
            </div>
          </div>

        </div>
        </section><!-- /stats-tier 4단 -->

        <!-- Phase 17-5: 필터링 목록 -->
        <section id="filtered-list-section" class="filtered-list-section" style="display: none">
          <div class="card">
            <div class="filtered-list-header">
              <div class="filtered-list-tabs">
                <button class="tab-btn active" data-category="documents" onclick="switchCategory('documents')">문서</button>
                <button class="tab-btn" data-category="chunks" onclick="switchCategory('chunks')">청크</button>
                <button class="tab-btn" data-category="labels" onclick="switchCategory('labels')">라벨</button>
                <button class="tab-btn" data-category="usage" onclick="switchCategory('usage')">사용량</button>
              </div>
              <button class="btn btn-sm" onclick="closeFilteredList()">닫기</button>
            </div>
            <div class="filtered-list-controls">
              <input type="text" id="filteredSearchInput" class="filtered-search" placeholder="검색..." />
              <select id="filteredTypeFilter" class="filtered-select">
                <option value="">전체</option>
              </select>
              <select id="filteredSortOrder" class="filtered-select" onchange="applyFilters()">
                <option value="desc">최신순</option>
                <option value="asc">오래된순</option>
              </select>
              <button class="btn btn-sm" onclick="resetFilters()">초기화</button>
            </div>
            <div class="table-container">
              <table id="filteredTable">
                <thead id="filteredTableHead"></thead>
                <tbody id="filteredTableBody">
                  <tr><td colspan="5" class="loading">카드를 클릭하세요</td></tr>
                </tbody>
              </table>
            </div>
            <div id="filteredPagination" class="filtered-pagination"></div>
          </div>
        </section>
      </div>
    </div>

    <script src="/static/js/components/layout-component.js"></script>
    <script src="/static/js/components/header-component.js"></script>
    <script src="/static/js/admin/admin-common.js"></script>
    <script src="/static/js/components/utils.js"></script>
    <script src="/static/js/admin/statistics-charts.js"></script>
    <script src="/static/js/admin/statistics.js"></script>
  </body>
</html>
