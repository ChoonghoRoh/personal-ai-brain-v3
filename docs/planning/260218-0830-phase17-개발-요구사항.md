# Phase 17 개발 요구사항

> 작성일: 2026-02-18
> 상태: 기획 (미착수)

---

## 1. 현재 상태 (AS-IS)

- 키워드 그룹 클릭 → 팝업(모달) → 우측 키워드 목록 표기 2단 레이아웃
- 그룹 목록 내부 스크롤 존재
- 수정/삭제 버튼이 그룹 목록 내부에 위치
- 새 그룹 버튼이 목록 상단에 소형으로 배치
- 페이지네이션 없음

## 2. 변경 요구사항 (TO-BE)

### 2.1 레이아웃 변경: 2단 → 3단

```
[AS-IS]
┌──────────────────┬──────────────────┐
│ 키워드 그룹 목록    │ 키워드 목록 (모달)  │
└──────────────────┴──────────────────┘

[TO-BE]
┌──────────┬──────────────┬──────────────┐
│ 그룹 목록  │  상세 (편집)   │  키워드 목록   │
└──────────┴──────────────┴──────────────┘
```

### 2.2 상단 영역 구조

```
┌─────────────────────────────────────────────────┐
│  키워드그룹 관리 (제목)              [ + 새 그룹 ]  │  ← 큰 버튼, 우측 배치
├─────────────────────────────────────────────────┤
│  [검색] [필터 영역]                               │
├──────────┬──────────────┬──────────────────────┤
│ 그룹 목록  │  그룹 상세     │  키워드 목록           │
│          │  (편집 폼)    │                      │
│          │  수정/삭제 버튼 │                      │
│          │              │                      │
├──────────┤              │                      │
│ 페이지네이션 │              │                      │
└──────────┴──────────────┴──────────────────────┘
```

### 2.3 세부 변경사항

| 항목 | 변경 내용 |
|------|----------|
| 레이아웃 | 2단(목록+모달) → 3단(목록+상세+키워드) |
| 자동 선택 | 최초 진입 시 1번째 키워드 그룹 자동 선택하여 3단 레이아웃 유지 |
| 내부 스크롤 | 그룹 목록 내부 스크롤 삭제 |
| 수정/삭제 버튼 | 그룹 목록에서 제거 → 2단(상세) 영역으로 이동 |
| 페이지네이션 | 그룹 목록 하단에 페이지네이션 추가 |
| 새 그룹 버튼 | 상단 제목 우측에 큰 버튼으로 이동 |
| 모달 | 편집용 모달 제거 → 상세 영역에서 인라인 편집 |

## 3. 관련 파일 (예상)

### Frontend
- `web/src/pages/admin/groups.html` — 메인 HTML
- `web/public/js/admin/admin-groups.js` — 페이지 초기화
- `web/public/js/admin/keyword-group-manager.js` — 매니저 클래스
- `web/public/js/admin/keyword-group-crud.js` — CRUD 로직
- `web/public/js/admin/keyword-group-suggestion.js` — 키워드 추천
- `web/public/js/admin/keyword-group-matching.js` — 키워드 매칭
- `web/public/css/admin/admin-styles.css` — 스타일

### Backend (변경 없을 가능성 높음)
- `backend/routers/knowledge/labels.py` — 그룹 API (페이지네이션 파라미터 추가 가능)

---

## 4. 지식 구조 트리 연결 방안 검토

### 4.1 개념

키워드 그룹 → 키워드 간 관계를 **플랫 1단계**에서 **다단계 트리 구조**로 확장하여,
웹사이트 메뉴 구조나 역할(Role) 기반 권한 체계와 유사한 계층형 지식 구조를 구성한다.

```
[예시: 트리 구조]

AI (1)
├── 인공지능 (1-1)
│   ├── LLM (1-1-1)
│   │   ├── 모델링 (1-1-1-1)
│   │   ├── 파인튜닝 (1-1-1-2)
│   │   └── 프롬프트 엔지니어링 (1-1-1-3)
│   └── 컴퓨터 비전 (1-1-2)
├── 머신러닝 (1-2)
│   ├── 지도학습 (1-2-1)
│   └── 비지도학습 (1-2-2)
└── 데이터 (1-3)
    ├── 전처리 (1-3-1)
    └── 벡터DB (1-3-2)
```

### 4.2 현재 DB 구조 분석

| 항목 | 현재 상태 |
|------|----------|
| `Label.parent_label_id` | FK → `labels.id`, self-referential 관계 정의됨 |
| 1단계 계층 (그룹↔키워드) | ✅ 구현됨 |
| 다단계 계층 (그룹↔하위그룹↔키워드) | ❌ 미구현 (DB 스키마는 가능) |
| 재귀 조회 (전체 트리 탐색) | ❌ 미구현 |
| 깊이 제한 / 순환 참조 방지 | ❌ 없음 |
| 트리뷰 UI | ❌ 없음 (플랫 리스트) |

> **참고**: DB 모델(`Label.parent_label_id` + self-referential relationship)은 이미 다단계 트리를 지원하는 구조이나, 애플리케이션 레벨에서 1단계만 활용 중.

### 4.3 트리 구조 도입 시 필요 작업 (예상)

#### Backend
| 항목 | 설명 |
|------|------|
| 재귀 트리 조회 API | 특정 노드의 전체 하위 트리 반환 (CTE 또는 ORM 재귀) |
| 깊이 제한 | 최대 허용 깊이 설정 (예: 5단계) |
| 순환 참조 방지 | 부모 설정 시 순환 검증 로직 |
| 노드 이동 API | 드래그&드롭으로 노드 위치 이동 지원 |
| 경로 조회 | 특정 노드의 루트까지 경로 (breadcrumb용) |

#### Frontend
| 항목 | 설명 |
|------|------|
| 트리뷰 컴포넌트 | 접기/펼치기 가능한 트리 UI |
| 드래그&드롭 | 노드 순서/위치 변경 |
| Breadcrumb | 현재 위치 경로 표시 |
| 검색 시 트리 하이라이트 | 검색 결과의 트리 경로 강조 |

### 4.4 AI 추천 연결 방식 검토

트리 노드 연결(부모-자식 관계 설정) 시 AI를 활용하는 방안:

| 방식 | 설명 |
|------|------|
| 자동 분류 추천 | 새 키워드 생성 시 → LLM이 기존 트리 구조를 분석하여 적합한 부모 노드 추천 |
| 구조 재편 제안 | 전체 트리를 분석하여 그룹핑/재구조화 제안 |
| 유사 노드 탐지 | 의미적으로 유사한 노드 감지 → 병합/연결 추천 |
| 빈 경로 추천 | 트리 구조의 빈 영역(gap) 분석 → 중간 노드 자동 생성 제안 |

---

## 5. 키워드 추천 아키텍처 분리 검토

### 5.1 현재 구조 (AS-IS)

청크 라벨 추천과 키워드 그룹 키워드 추천이 **동일한 함수**를 공유한다.

```
[청크 라벨 추천]
  청크관리 UI → /api/labels/groups/suggest-keywords
       └→ labels_handlers.handle_suggest_keywords()
            └→ RecommendationService.recommend_labels_with_llm()
                 └→ chunk_id 유무로 분기 (프롬프트만 다름)

[키워드 그룹 추천]
  키워드그룹 UI → /api/labels/groups/suggest-keywords
       └→ labels_handlers.handle_suggest_keywords()
            └→ RecommendationService.recommend_labels_with_llm()
                 └→ chunk_id=None 분기
```

### 5.2 문제점

| 문제 | 설명 |
|------|------|
| 단일 함수 과부하 | `recommend_labels_with_llm()`에 chunk_id 분기, existing_keyword_names 분기 등 조건이 누적 |
| 프롬프트 관리 혼재 | 추출(청크)용 프롬프트와 생성(그룹)용 프롬프트가 한 함수 내 분기 |
| 독립 확장 어려움 | 한쪽 기능 수정 시 다른 쪽 영향도 확인 필요 |
| 테스트 복잡도 | 하나의 함수에서 두 가지 시나리오를 모두 커버해야 함 |

### 5.3 변경 방향 (TO-BE)

```
[공통 계층]
  LLMClient (Ollama 호출, 모델 관리, 언어 필터)
       │
  ┌────┴────┐
  │ 공통 유틸 │  ← 키워드 정제, 중복 제거, 매칭 로직
  └────┬────┘
       │
  ┌────┴──────────────────┐
  │                       │
[청크 라벨 추천]      [키워드 그룹 추천]
  ChunkLabelRecommender    GroupKeywordRecommender
  - 텍스트 → 키워드 추출     - 설명 → 키워드 생성
  - 청크 컨텍스트 활용       - 기존 키워드 제외
  - 전용 프롬프트           - 전용 프롬프트 + few-shot
  - chunk_id 필수          - group_id 참조
```

### 5.4 분리 시 예상 구조

| 계층 | 파일 (예상) | 역할 |
|------|------------|------|
| 공통 LLM | `backend/services/reasoning/llm_client.py` | Ollama 호출, 모델 폴백, 응답 파싱 |
| 공통 유틸 | `backend/utils/korean_utils.py` (기존) | 한국어 키워드 정제, 언어 필터 |
| 청크 추천 | `backend/services/reasoning/chunk_label_recommender.py` | 청크 전용 추출 로직 |
| 그룹 추천 | `backend/services/reasoning/group_keyword_recommender.py` | 그룹 전용 생성 로직 |
| 기존 통합 | `backend/services/reasoning/recommendation_llm.py` | 점진적 마이그레이션 후 deprecate |

### 5.5 각 기능별 설정 차이

| 설정 항목 | 청크 라벨 추천 | 키워드 그룹 추천 |
|----------|--------------|----------------|
| 입력 | 청크 본문 (긴 텍스트) | 그룹 설명 (짧은 텍스트) |
| 프롬프트 전략 | 추출형 (텍스트에서 키워드 뽑기) | 생성형 (의미 해석 후 키워드 생성) |
| 컨텍스트 | 청크 주변 데이터, 기존 라벨 | 기존 그룹 키워드 (제외용) |
| 모델 설정 | 기본 모델 | 사용자 선택 가능 |
| 출력 형태 | 기존 라벨 매칭 위주 | 새 키워드 생성 + 기존 매칭 |
| few-shot | 불필요 | 필요 (예시 기반 생성 품질 향상) |

---

## 6. 검색 메뉴 및 추천 문서 개선

### 6.1 현재 상태 (AS-IS)

| 항목 | 검색 페이지 (search.html) | Reasoning 페이지 (reason.html) |
|------|--------------------------|-------------------------------|
| 추천 문서 형태 | 단순 리스트 (제목만) | 그리드 카드 + 4탭 UI |
| 표시 필드 | `doc.name` 또는 `doc.file_path` | 제목, 문서명, 유사도, 내용 미리보기 |
| 상단 조회/필터 | ❌ 없음 | ✅ 탭 전환 (관련 청크/샘플 질문/추천 라벨/추가 탐색) |
| 폴더 경로 표시 | 검색 결과에만 표시, 추천 문서엔 없음 | 문서명만 표시 |

### 6.2 문제점

| 문제 | 설명 |
|------|------|
| 추천 문서-폴더 불일치 | 추천 문서 하단 목록과 실제 파일 관리 폴더 구조가 일치하지 않음 |
| 유사어 필터링 미완성 | 유사어(동의어) 검색 시 파일명 전체가 필터링되지 않음 (본문만 검색, 파일명 매칭 누락) |
| 추천 문서 정보 부족 | 제목만 표시되어 어떤 폴더의 어떤 크기 파일인지 판단 불가 |
| 조회 기능 없음 | 추천 문서 영역에 정렬/필터/검색 옵션 없음 |

### 6.3 변경 요구사항 (TO-BE)

#### A. 추천 문서 그리드 시스템 적용

```
[AS-IS] 단순 리스트
┌───────────────────────────┐
│ 📄 문서제목A               │
│ 📄 문서제목B               │
│ 📄 문서제목C               │
└───────────────────────────┘

[TO-BE] 그리드 + 상세 정보
┌─────────────────────────────────────────────────┐
│  [검색/필터]  [정렬: 최신순 ▼]  [폴더 필터 ▼]     │  ← 조회 영역
├────────────────┬────────────────┬────────────────┤
│ 📄 문서제목A    │ 📄 문서제목B    │ 📄 문서제목C    │
│ 📁 brain/ai/   │ 📁 brain/dev/  │ 📁 brain/ml/   │
│ 💾 12.5 KB     │ 💾 8.2 KB      │ 💾 24.1 KB     │
├────────────────┼────────────────┼────────────────┤
│ 📄 문서제목D    │ 📄 문서제목E    │                │
│ 📁 brain/web/  │ 📁 brain/db/   │                │
│ 💾 5.7 KB      │ 💾 15.3 KB     │                │
└────────────────┴────────────────┴────────────────┘
```

#### B. 그리드 카드 표시 필드

| 필드 | 설명 |
|------|------|
| 제목 | 문서 제목 또는 파일명 |
| 폴더 위치 | 파일의 전체 경로 (brain/카테고리/하위폴더/) |
| 크기 | 파일 크기 (KB/MB 단위) |
| 최종 수정일 | 파일 업데이트 일시 (선택) |

#### C. 추천 문서 상단 조회 영역 추가

| 기능 | 설명 |
|------|------|
| 검색 필터 | 추천 문서 내 텍스트 검색 |
| 폴더 필터 | 특정 폴더 하위 문서만 표시 (파일 관리 폴더 구조와 일치) |
| 정렬 옵션 | 최신순 / 유사도순 / 파일크기순 / 이름순 |
| 표시 개수 | 페이지네이션 또는 더 보기 버튼 |

#### D. 유사어 검색 시 파일명 필터링 보완

| 항목 | 현재 | 개선 |
|------|------|------|
| 키워드 검색 대상 | `content` (본문) ILIKE만 적용 | `content` + `file_path` (파일명) 모두 ILIKE 적용 |
| 의미 검색 대상 | 본문 임베딩만 검색 | 파일명 메타데이터 필터 추가 검토 |
| 폴더 구조 일치화 | 추천 문서가 폴더 구조와 무관하게 나열 | 폴더 트리와 연동하여 그룹핑 |

### 6.4 관련 파일

| 구분 | 파일 |
|------|------|
| 검색 HTML | `web/src/pages/search.html` |
| 검색 JS | `web/public/js/search/search.js` |
| 검색 CSS | `web/public/css/search.css` |
| 검색 API | `backend/routers/search/search.py` |
| 문서 API | `backend/routers/search/documents.py` |
| Hybrid 검색 | `backend/services/search/hybrid_search.py` |
| Reasoning 추천 | `backend/services/reasoning/recommendation_service.py` |

---

## 7. AI 질의 기능 고도화

### 7.1 현재 상태 (AS-IS)

| 항목 | 상태 | 비고 |
|------|------|------|
| 단일 질문 → AI 답변 | ✅ 구현 | SSE 스트리밍, 5단계 진행 표시 |
| 4가지 Reasoning 모드 | ✅ 구현 | 설계설명, 리스크, 다음단계, 히스토리 |
| 의사결정 문서 저장 | ✅ 구현 | 제목+요약 입력 후 DB 저장 |
| 의사결정 문서 조회/삭제 | ✅ 구현 | 단순 리스트 형태 |
| 결과 공유 (URL) | ✅ 구현 | share_id 기반, 만료 옵션 |
| **토픽 이어서 질문하기** | ❌ 미구현 | 각 요청이 독립 실행, 컨텍스트 미유지 |
| **대화 요약 → 다음 참조** | ❌ 미구현 | 자동 요약 기능 없음 |
| **대화 기록 그리드 목록** | ❌ 미구현 | 의사결정 목록만 단순 리스트 |
| **페이지네이션** | ❌ 미구현 | 전체 목록 한 번에 로드 |

### 7.2 DB 구조 분석

`ReasoningResult` 테이블에 `session_id` 필드가 이미 존재하나 활용되지 않고 있음.

```
[현재 DB 구조]
ReasoningResult
├── id (PK)
├── question          ← 질문
├── answer            ← 답변
├── reasoning_steps   ← JSON: 5단계 진행 기록
├── context_chunks    ← JSON: 사용된 청크
├── mode              ← reasoning 모드
├── session_id        ← ⚠️ 존재하지만 미활용 (대화 세션 그룹핑 가능)
├── share_id          ← 공유 URL
├── title / summary   ← 의사결정 문서용
└── created_at
```

### 7.3 변경 요구사항 (TO-BE)

#### A. 토픽 이어서 질문하기

```
[AS-IS] 단발 질의
  질문 A → 답변 A (끝)
  질문 B → 답변 B (끝, A와 무관)

[TO-BE] 멀티턴 대화
  질문 A → 답변 A
      └→ 이어서 질문 A-1 → 답변 A-1 (A의 컨텍스트 포함)
           └→ 이어서 질문 A-2 → 답변 A-2 (A + A-1 컨텍스트 포함)
```

| 항목 | 설명 |
|------|------|
| 세션 관리 | `session_id`로 대화 흐름 그룹핑 |
| 컨텍스트 전달 | 이전 대화의 요약을 다음 질문 시 프롬프트에 포함 |
| UI | 답변 하단에 "이어서 질문하기" 버튼 추가 |
| 대화 스레드 | 동일 세션의 질문-답변을 시간순으로 스레드 형태 표시 |

#### B. 대화 기록 요약 → 다음 대화 참조

```
[흐름]
  대화 완료 → 자동 요약 생성 (LLM) → DB 저장
      ↓
  다음 대화 시 → 이전 요약을 컨텍스트로 주입
      ↓
  AI가 이전 맥락을 이해한 상태에서 답변
```

| 항목 | 설명 |
|------|------|
| 자동 요약 | 대화 완료 시 LLM으로 핵심 내용 2~3문장 요약 생성 |
| 요약 저장 | `ReasoningResult.summary` 필드 활용 또는 별도 컬럼 추가 |
| 컨텍스트 주입 | 이어서 질문 시 이전 요약을 시스템 프롬프트에 포함 |
| 토큰 관리 | 요약 길이 제한 (최근 N턴 요약만 포함, 오래된 것은 누적 요약) |

#### C. 대화 기록 조회 영역 추가

```
[TO-BE] 대화 기록 조회 UI
┌─────────────────────────────────────────────────────────┐
│  AI 질의 기록                                [검색 🔍]   │
├────┬──────────────┬──────────┬──────────┬───────┬──────┤
│ ☐  │ 질문 제목     │ 모드      │ 일시      │ 턴 수  │ 액션 │
├────┼──────────────┼──────────┼──────────┼───────┼──────┤
│ ☐  │ AI 설계 패턴  │ 설계설명   │ 02-18 09 │  3턴  │ 보기 │
│ ☐  │ DB 최적화    │ 리스크    │ 02-17 14 │  1턴  │ 보기 │
│ ☐  │ API 구조 검토 │ 다음단계   │ 02-16 11 │  5턴  │ 보기 │
├────┴──────────────┴──────────┴──────────┴───────┴──────┤
│  [선택 삭제]                          ◀ 1  2  3  4 ▶   │
└─────────────────────────────────────────────────────────┘
```

#### D. 대화 기록 그리드 표시 필드

| 필드 | 설명 |
|------|------|
| 체크박스 | 다중 선택 (일괄 삭제용) |
| 질문 제목 | 첫 질문 텍스트 또는 의사결정 문서 제목 |
| Reasoning 모드 | 사용된 모드 (설계설명/리스크/다음단계/히스토리) |
| 일시 | 생성 시각 |
| 턴 수 | 동일 session_id 내 대화 횟수 |
| 액션 | 보기 (상세 조회 + 이어서 질문), 삭제 |

#### E. 선택 삭제 기능

| 기능 | 설명 |
|------|------|
| 개별 삭제 | 각 행의 삭제 버튼 |
| 다중 선택 삭제 | 체크박스 선택 → "선택 삭제" 버튼 |
| 전체 선택 | 헤더 체크박스로 현재 페이지 전체 선택/해제 |
| 삭제 확인 | 삭제 전 확인 모달 (영향도: 연결된 공유 URL 만료 안내) |

#### F. 하단 페이지네이션

| 항목 | 설명 |
|------|------|
| 페이지 크기 | 기본 10건, 옵션 (10/20/50) |
| 네비게이션 | ◀ 이전 / 페이지 번호 / 다음 ▶ |
| 총 건수 표시 | "전체 47건 중 1~10건" |
| Backend API | `GET /api/reason/decisions?page=1&size=10&q=검색어` |

### 7.4 필요 작업 (예상)

#### Backend

| 작업 | 설명 |
|------|------|
| 세션 관리 API | `POST /api/reason/sessions` — 새 세션 생성, `GET /api/reason/sessions/{id}` — 세션 대화 이력 |
| 이어서 질문 API | 기존 `/api/reason/stream`에 `session_id` 파라미터 추가, 이전 요약 자동 포함 |
| 자동 요약 | 답변 완료 후 LLM으로 대화 요약 생성 → DB 저장 |
| 페이지네이션 API | `GET /api/reason/decisions` 에 `page`, `size`, `sort` 파라미터 추가 |
| 다중 삭제 API | `DELETE /api/reason/decisions/batch` — `{ids: [1,2,3]}` |

#### Frontend

| 작업 | 설명 |
|------|------|
| 대화 스레드 UI | 동일 세션 질문-답변을 시간순 스레드로 표시 |
| "이어서 질문하기" 버튼 | 답변 하단에 배치, 클릭 시 session_id 유지하며 질문 입력 활성화 |
| 그리드 목록 | 대화 기록을 테이블 형태로 표시 (체크박스, 정렬, 검색) |
| 페이지네이션 컴포넌트 | 공통 페이지네이션 UI (키워드 그룹과 재사용 가능) |
| 선택 삭제 | 체크박스 + 일괄 삭제 버튼 + 확인 모달 |

### 7.5 관련 파일

| 구분 | 파일 |
|------|------|
| Reasoning HTML | `web/src/pages/reason.html` |
| Reasoning JS (진입점) | `web/public/js/reason/reason.js` |
| SSE/상태 제어 | `web/public/js/reason/reason-control.js` |
| 결과 렌더링 | `web/public/js/reason/reason-render.js` |
| 데이터 모델 | `web/public/js/reason/reason-model.js` |
| 스트리밍 API | `backend/routers/reasoning/reason_stream.py` |
| 저장/공유 API | `backend/routers/reasoning/reason_store.py` |
| SSE 실행 엔진 | `backend/routers/reasoning/stream_executor.py` |
| DB 모델 | `backend/models/models.py` — `ReasoningResult` |

---

## 8. 로그 통계 개선

### 8.1 현재 상태 (AS-IS)

두 개의 페이지가 분리되어 운영 중:

| 페이지 | 파일 | 상단 요약 | 하단 목록 | 필터 | 페이징 |
|--------|------|----------|----------|------|--------|
| 로그 | `logs.html` | stats-grid (액션별 카운트) | Timeline UI | ✅ 날짜/액션/검색어 | ✅ 10/20/50/100건 |
| 통계 | `admin/statistics.html` | 4개 카드 (문서/청크/라벨/사용량) | 테이블 + 차트 | ⚠️ 트렌드 기간만 | ❌ 전체 표시 |

### 8.2 문제점

| 문제 | 설명 |
|------|------|
| 상단 숫자 클릭 미동작 | 요약 카드의 숫자를 클릭해도 하단 목록이 필터링되지 않음 (정적 표시만) |
| 하단 목록 조회 부족 | 통계 페이지의 테이블(인기 라벨, 프로젝트별 현황)에 검색/필터 없음 |
| 제목/내용 검색 미지원 | 로그 페이지는 검색어 필터가 있으나, 통계 페이지 테이블에는 조회 기능 없음 |

### 8.3 변경 요구사항 (TO-BE)

#### A. 상단 요약 숫자 클릭 → 하단 필터링

```
[AS-IS]
┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐
│ 문서  │ │ 청크  │ │ 라벨  │ │ 사용량 │   ← 클릭 불가, 정적 표시
│  124 │ │  892 │ │  57  │ │  23  │
└──────┘ └──────┘ └──────┘ └──────┘

[TO-BE]
┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐
│ 문서  │ │ 청크  │ │ 라벨  │ │ 사용량 │   ← 클릭 시 해당 카테고리로
│  124 │ │  892 │ │  57  │ │  23  │       하단 목록 필터링
└──┬───┘ └──────┘ └──────┘ └──────┘
   │ 클릭!
   ▼
┌─────────────────────────────────────┐
│ [문서] 필터 활성화                     │
│  제목 검색 [________]  [초기화]       │
├────┬──────────┬───────┬────────────┤
│ #  │ 문서 제목  │ 유형   │ 생성일      │   ← 문서 카테고리만 필터링
├────┼──────────┼───────┼────────────┤
│ 1  │ AI 설계   │ .md   │ 02-18      │
│ 2  │ DB 구조   │ .md   │ 02-17      │
└────┴──────────┴───────┴────────────┘
```

| 카드 | 클릭 시 동작 |
|------|------------|
| 문서 | 하단 목록을 문서 목록으로 전환, 문서 유형별 필터 |
| 청크 | 하단 목록을 청크 목록으로 전환, 상태별 필터 |
| 라벨 | 하단 목록을 라벨 목록으로 전환, 유형별 필터 |
| 사용량 | 하단 목록을 추론 기록으로 전환, 날짜별 필터 |

#### B. 하단 목록 조회 영역 추가

```
[TO-BE] 통계 하단 목록
┌─────────────────────────────────────────────────┐
│  [제목 검색 🔍]  [내용 검색 🔍]  [유형 필터 ▼]    │  ← 조회 영역
├────┬──────────────┬────────┬──────────┬─────────┤
│ #  │ 제목          │ 유형    │ 내용 미리보기│ 날짜    │
├────┼──────────────┼────────┼──────────┼─────────┤
│ 1  │ AI 아키텍처   │ keyword │ 설계 패턴…│ 02-18  │
│ 2  │ DB 최적화     │ project │ 쿼리 튜닝…│ 02-17  │
├────┴──────────────┴────────┴──────────┴─────────┤
│                                ◀ 1  2  3  4 ▶   │
└─────────────────────────────────────────────────┘
```

| 기능 | 설명 |
|------|------|
| 제목 검색 | 항목 이름/제목으로 필터링 |
| 내용 검색 | 항목 내용/설명으로 필터링 |
| 유형 필터 | 드롭다운으로 카테고리 선택 |
| 정렬 | 컬럼 헤더 클릭 시 오름차순/내림차순 토글 |
| 페이지네이션 | 하단 페이지 네비게이션 |

### 8.4 관련 파일

| 구분 | 파일 |
|------|------|
| 로그 HTML | `web/src/pages/logs.html` |
| 로그 JS | `web/public/js/logs/logs.js` |
| 로그 CSS | `web/public/css/logs.css` |
| 통계 HTML | `web/src/pages/admin/statistics.html` |
| 통계 JS | `web/public/js/admin/statistics.js` |
| 통계 차트 JS | `web/public/js/admin/statistics-charts.js` |
| 통계 CSS | `web/public/css/statistics.css` |
| 로그 API | `backend/routers/system/logs.py` |
| 통계 API | `backend/routers/system/statistics.py` |
| 통계 서비스 | `backend/services/system/statistics_service.py` |

---

## 9. 통계 메뉴 레이아웃 리뉴얼

### 9.1 현재 상태 (AS-IS)

```
[AS-IS] 현재 통계 페이지 레이아웃
┌─────────────────────────────────────────────────┐
│  통계 (제목)  (설명)                   [새로고침]  │  ← 헤더
├───────────┬───────────┬───────────┬─────────────┤
│ 총문서     │ 총청크     │ 총라벨     │ 오늘사용     │  ← 요약 카드 (4열 그리드)
├───────────┴───┬───────┴───┬───────┴─────────────┤
│ 문서유형 분포   │ 청크상태 분포│ 라벨유형 분포        │  ← 분포 차트 (3열 그리드)
├───────────────┴───────────┴─────────────────────┤
│  일별 트렌드 (최근 7일)              [기간 선택 ▼]  │  ← 트렌드 (전체 너비)
├───────────┬───────────┬─────────────────────────┤
│ 인기라벨    │ 프로젝트별  │ 시스템 상태             │  ← 테이블 (3열 그리드)
│ TOP 10    │ 현황       │ (DB/Qdrant/Redis/LLM)   │
└───────────┴───────────┴─────────────────────────┘
```

- 요약 카드, 분포 차트, 트렌드, 테이블+시스템 상태가 혼재
- 서브타이틀 없이 카드 제목만 존재
- 각 섹션 간 구분이 불명확

### 9.2 변경 요구사항 (TO-BE)

위에서 아래로 **4단 레이아웃**으로 정리:

```
[TO-BE] 통계 페이지 4단 레이아웃

━━━ 1단: 요약 수치 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  서브타이틀: 요약                              [새로고침]
┌───────────┬───────────┬───────────┬─────────────┐
│ 📄 총문서  │ 🧩 총청크  │ 🏷️ 총라벨 │ 📊 오늘사용  │
│   124     │   892     │    57     │    23       │
│ 최근7일:+5 │ 승인:840  │ 프로젝트:8 │ 총추론:156  │
└───────────┴───────────┴───────────┴─────────────┘

━━━ 2단: 분포 차트 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  서브타이틀: 분포 현황
┌──────────────┬──────────────┬──────────────┐
│ 문서유형 분포  │ 청크상태 분포  │ 라벨유형 분포  │
│  (Doughnut)  │   (Bar)      │  (Doughnut)  │
└──────────────┴──────────────┴──────────────┘

━━━ 3단: 트렌드 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  서브타이틀: 일일 트렌드                    [7일▼ 14일 30일]
┌─────────────────────────────────────────────────┐
│                  (Line Chart)                    │
└─────────────────────────────────────────────────┘

━━━ 4단: 상세 테이블 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  서브타이틀: 상세 현황
┌───────────────────────┬─────────────────────────┐
│ 인기 라벨 TOP 10       │ 프로젝트별 현황           │
│ (테이블 + 조회 영역)    │ (테이블 + 조회 영역)      │
└───────────────────────┴─────────────────────────┘
```

### 9.3 세부 변경사항

| 항목 | AS-IS | TO-BE |
|------|-------|-------|
| 전체 구조 | 섹션 혼재 | 4단 레이아웃 (요약→분포→트렌드→상세) |
| 서브타이틀 | 없음 | 각 단마다 서브타이틀 + 새로고침 버튼 |
| 시스템 상태 | 통계 페이지 하단에 배치 | 대시보드로 이동 (§10 참조) |
| 테이블 영역 | 3열 (라벨+프로젝트+시스템) | 2열 (라벨+프로젝트), 시스템 상태 분리 |
| 섹션 구분 | 카드 간격만 | 서브타이틀 + 구분선으로 명확 분리 |

### 9.4 관련 파일

| 구분 | 파일 |
|------|------|
| 통계 HTML | `web/src/pages/admin/statistics.html` |
| 통계 JS | `web/public/js/admin/statistics.js` |
| 차트 JS | `web/public/js/admin/statistics-charts.js` |
| 통계 CSS | `web/public/css/statistics.css` |

---

## 10. 대시보드 디자인 리뉴얼

### 10.1 현재 상태 (AS-IS)

```
[AS-IS] 현재 대시보드 레이아웃 (위→아래)
┌─────────────────────────────────────────┐
│ 1. 통계 카드 (총문서/Qdrant/프로젝트/작업)  │
├─────────────────────────────────────────┤
│ 2. Reasoning 빠른시작                    │
├─────────────────────────────────────────┤
│ 3. 지식관리                              │
├─────────────────────────────────────────┤
│ 4. 시스템 상태 (DB/Qdrant/LLM 상세)       │  ← 큰 영역 차지
├─────────────────────────────────────────┤
│ 5. 최근 작업                             │
├─────────────────────────────────────────┤
│ 6. 자동화 상태                           │
├─────────────────────────────────────────┤
│ 7. 최근 업데이트 문서 (리스트)              │
├─────────────────────────────────────────┤
│ 8. 활동 분석 (7일 막대그래프 + 요약)        │
├─────────────────────────────────────────┤
│ 9. 문서 목록 (검색 + 폴더별 그룹)          │
└─────────────────────────────────────────┘
```

### 10.2 변경 요구사항 (TO-BE)

```
[TO-BE] 대시보드 리뉴얼 레이아웃

━━━ 1줄: 시스템 상태 (한줄 요약) ━━━━━━━━━━━━━━━━━━━━━━━
┌────────────┬────────────┬────────────┬────────────┐
│ 🟢 PostgreSQL│ 🟢 Qdrant  │ 🟡 Redis   │ 🟢 Ollama  │
└────────────┴────────────┴────────────┴────────────┘

━━━ 2줄: 등록 지식 현황 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
┌───────────┬───────────┬───────────┬─────────────┐
│ 📄 총문서  │ 🧩 총청크  │ 🏷️ 총라벨 │ 📁 프로젝트  │
│   124     │   892     │    57     │     8       │
└───────────┴───────────┴───────────┴─────────────┘

━━━ 3줄: Reasoning 가이드 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
┌─────────────────────────────────────────────────┐
│ 💡 AI Reasoning 가이드                           │
│                                                 │
│  설계/배경 설명  →  코드 구조, 아키텍처 의도 분석    │
│  리스크 분석    →  잠재적 문제점, 영향도 평가       │
│  다음 단계 제안  →  TODO, 구현 순서 추천           │
│  히스토리 추적   →  변경 이력, 의사결정 맥락 탐색    │
│                                                 │
│  [Reasoning 시작하기 →]                          │
└─────────────────────────────────────────────────┘

━━━ 4줄: 주요 기능 바로가기 ━━━━━━━━━━━━━━━━━━━━━━━━━━━
┌──────────────────┬──────────────────────────────┐
│ 📚 Knowledge     │ 🔧 Knowledge Admin           │
│    Studio        │    지식 관리·라벨·그룹·승인     │
│  지식 탐색·검색   │                              │
│  [바로가기 →]     │  [바로가기 →]                  │
└──────────────────┴──────────────────────────────┘

━━━ 5줄: 최근 업데이트 문서 (카드뷰) ━━━━━━━━━━━━━━━━━━━
  서브타이틀: 최근 업데이트 문서
┌──────────────┬──────────────┬──────────────┐
│ 📄 AI 설계문서 │ 📄 DB 스키마  │ 📄 API 명세   │
│ brain/ai/    │ brain/db/    │ brain/api/   │
│ 수정: 10분 전  │ 수정: 1시간 전 │ 수정: 3시간 전 │
│ "아키텍처 패턴 │ "테이블 구조를│ "엔드포인트   │
│  변경 적용..." │  최적화..."   │  추가..."     │
└──────────────┴──────────────┴──────────────┘

━━━ 6줄: 활동 분석 (통계 메뉴 내용으로 변경) ━━━━━━━━━━━
  서브타이틀: 활동 분석
┌──────────────┬──────────────┬──────────────┐
│ 문서유형 분포  │ 청크상태 분포  │ 라벨유형 분포  │
│  (Doughnut)  │   (Bar)      │  (Doughnut)  │
├──────────────┴──────────────┴──────────────┤
│  일별 트렌드 (최근 7일)                      │
└─────────────────────────────────────────────┘
```

### 10.3 세부 변경사항

| # | 항목 | AS-IS | TO-BE |
|---|------|-------|-------|
| 1 | 시스템 상태 | 큰 영역 (DB/Qdrant/LLM 상세 + 테스트 버튼) | 한줄 요약 (상태 아이콘 + 이름만, 상세는 통계 페이지로) |
| 2 | 등록 지식 현황 | 통계 카드에 Qdrant 포인트/작업수 혼재 | 총문서/총청크/총라벨/프로젝트 — 지식 중심 수치만 표시 |
| 3 | Reasoning 가이드 | 빠른시작 링크만 (1줄) | 4가지 모드별 설명 + 시작하기 버튼 — 사용자 가이드 역할 |
| 4 | 기능 바로가기 | Knowledge Studio + Knowledge Admin 분리 | Knowledge Studio + Admin 을 한줄에 카드형으로 배치 |
| 5 | 삭제 항목 | 최근 작업, 자동화 상태, 문서 목록 | 삭제 (대시보드에서 제거, 필요 시 로그/통계 페이지에서 확인) |
| 6 | 최근 업데이트 문서 | 리스트 형태 (제목 + 경로만) | 카드뷰 (제목 + 폴더 + 수정시간 + 내용 일부 미리보기) |
| 7 | 활동 분석 | 자체 7일 막대그래프 + 4개 요약 숫자 | 통계 메뉴의 분포 차트 + 트렌드 차트로 교체 |

### 10.4 삭제 대상 영역

| 영역 | 사유 | 대체 |
|------|------|------|
| 최근 작업 (`#recent-work`) | 로그 페이지에서 동일 내용 조회 가능 | `logs.html` |
| 자동화 상태 (`#automation-status`) | 시스템 상태 한줄 요약으로 통합 또는 관리 메뉴로 이동 | 관리 메뉴 |
| 문서 목록 (`#documents-list`) | 검색 페이지에서 동일 기능 제공 | `search.html` |

### 10.5 관련 파일

| 구분 | 파일 |
|------|------|
| 대시보드 HTML | `web/src/pages/dashboard.html` |
| 대시보드 JS | `web/public/js/dashboard/dashboard.js` |
| 대시보드 API | `web/public/js/dashboard/dashboard-api.js` |
| 대시보드 CSS | `web/public/css/dashboard.css` |
| 통계 JS (차트 재사용) | `web/public/js/admin/statistics-charts.js` |
| 통계 API (데이터 재사용) | `backend/routers/system/statistics.py` |

---

## 11. 우선순위 및 의존 관계

```
[Phase A] 키워드 그룹 3단 레이아웃 리뉴얼 (§2)
    ↓
[Phase B] 키워드 추천 아키텍처 분리 (§5)
    ↓
[Phase C] 검색 메뉴 + 추천 문서 개선 (§6)
    ↓
[Phase D] AI 질의 고도화 — 멀티턴 대화 + 기록 관리 (§7)
    ↓
[Phase E] 로그 통계 개선 — 카드 클릭 필터링 + 목록 조회 (§8)
    ↓
[Phase F] 통계 메뉴 4단 레이아웃 리뉴얼 (§9)
    ↓
[Phase G] 대시보드 디자인 리뉴얼 (§10)
    ↓
[Phase H] 트리 구조 + AI 추천 연결 (§4)
```

> Phase A는 UI 변경만으로 독립 진행 가능.
> Phase B는 기존 기능 안정화 후 리팩토링.
> Phase C는 검색 품질 개선 + 추천 문서 UI 고도화. A/B와 독립 병행 가능.
> Phase D는 AI 질의 핵심 기능 확장. session_id 활용 + 대화 요약 + 그리드 목록.
> Phase E는 기존 통계 UI 개선. 독립 진행 가능 (C/D와 병행 가능).
> Phase F는 통계 페이지 레이아웃 정리. E 완료 후 진행 권장.
> Phase G는 대시보드 전면 리디자인. F 완료 후 진행 (통계 차트 재사용 의존).
> Phase H는 가장 큰 구조적 변경이므로 B 완료 후 착수.
