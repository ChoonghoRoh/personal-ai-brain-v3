# Phase 20 작업 목록: 선행 핫픽스·리팩토링 + 검색/AI질의/지식구조 고도화 + 청크 2단계 + AI Chat·코그니티브·그래프

**작성일**: 2026-02-22
**최종 수정**: 2026-02-22 (Phase 19 핫픽스 + 추천 3가지 고도화 + 검증 지표 추가)
**선행 분석 문서**: [Phase 20 선행 분석 결과](260222-phase20-선행분석결과.md)
**선행 조건**: Phase 19 Chain 완료 (19-1~19-4, G1~G4 ALL PASS) + **Phase 19 브라우저 E2E 테스트 미해결 이슈 5건 해소**
**근거 문서**:
- [PAB 검색 통합/개선 보고서](260221-2330-pab-검색-통합-개선-보고서.md)
- [PAB AI 질의 통합/개선 보고서](260221-2330-pab-ai질의-통합-개선-보고서.md)
- [PAB 지식구조 통합/개선 보고서](260221-2330-pab-지식구조-통합-개선-보고서.md)
- [Phase 19 정밀분석 - 청크 관리 2단계](260221-phase19-정밀분석.md#23-2단계-6개월-stepper-기반-워크플로우)
- **[Phase 19 브라우저 테스트 결과](../phases/phase-19-browser-test.md)** ← 미해결 이슈 5건
- [리팩토링 레지스트리](../refactoring/refactoring-registry.md)
- [리팩토링 규정](../refactoring/refactoring-rules.md)

---

## 1. 전체 방향 요약

Phase 19에서 관리자 도구(키워드 추천, 그룹 UI, 청크 탭 통합, 통계 레이아웃)를 고도화했다면,
Phase 20은 **선행 리팩토링으로 코드 건강성을 확보**한 뒤, **사용자 경험 핵심 3축(검색, AI 질의, 지식구조)의 연계 강화 + 청크 워크플로우 2단계**에 집중한다.

### 9대 방향

| # | 방향 | 핵심 가치 | 우선순위 |
|---|------|----------|:--------:|
| 0 | **Phase 19 핫픽스** | 브라우저 E2E 테스트 미해결 이슈 5건 해소 | **P0** |
| 1 | **선행 리팩토링** | 후속 Phase의 코드 품질 기반 확보 (REFACTOR-2) | **P0** |
| 2 | **청크 관리 2단계** | Stepper 워크플로우 + 빠른 생성+승인 | P1 |
| 3 | **검색 고도화** | 고급 필터 + 결과 근거/출처 + 성능 | P1 |
| 4 | **AI 질의 고도화** | RAG 컨텍스트 제어 + 출처 표시 | P1 |
| 5 | **지식구조 고도화** | 이력 통합 뷰 + 라벨/관계 품질 | P2 |
| 6 | **AI 대화 UX 리뉴얼** | `/ask` 현대적 Chat Interface 전환 (스트리밍·세션·액션) | P2 |
| 7 | **코그니티브 대시보드** | Memory·Learning·Personality 등 기존 BE 5모듈 FE 통합 뷰 | P2 |
| 8 | **지식 그래프 인터랙티브 탐색** | 시맨틱 라벨링 + 컬러코딩 + 필터 + 클러스터 시각화 | P2 |

---

## 2. 방향별 상세 분석

### 2.0 Phase 19 핫픽스 (P0) — Phase 20-0

**배경**: Phase 19 브라우저 E2E 테스트(2026-02-22, 23 TC)에서 발견된 미해결 이슈 5건.
Phase 19 Chain은 G1~G4 단위 테스트 기준 ALL PASS였으나, 실제 브라우저 E2E 검증에서 코드 레벨 버그와 UI 미완성이 확인됨.
Phase 20 본작업 전에 반드시 해소해야 하는 선행 핫픽스.

**근거 문서**: [Phase 19 브라우저 테스트 결과](../phases/phase-19-browser-test.md)

#### 이슈 목록

| ISS | 심각도 | Phase | 설명 | 수정 대상 파일 | 도메인 |
|:---:|:------:|:-----:|------|--------------|:------:|
| **ISS-1** | **Critical** | 19-1 | AI 키워드 추천 버튼 클릭 시 `TypeError: Cannot set properties of null (setting 'disabled')` at line 55. 인라인 편집 폼(19-3) 전환 후 DOM 요소 참조 깨짐 | `web/public/js/admin/keyword-group-suggestion.js` | [FE] |
| **ISS-7** | **High** | 19-4 | 초기 탭 `activate()` 미호출 — `knowledge-workflow.js` 생성자에서 `syncFromUrl()` → `switchTab("create")` 시 early return + `registerTab()`이 `activate()` 미호출. 결과: 첫 로드 시 생성 탭 파일 목록 영구 로딩 | `web/public/js/admin/knowledge-workflow.js` | [FE] |
| **ISS-4** | **High** | 19-4 | LNB에 "지식 워크플로우" 통합 메뉴 미표시. 기존 3개 메뉴(청크 생성, 청크 승인, 청크 관리) 미삭제 | `web/public/js/components/header-component.js` | [FE] |
| **ISS-5** | **Medium** | 19-2 | Tablet(1000px) 요약 카드 오버플로우 — `.admin-container` grid `720px+742px=1462px` > 컨테이너 780px | `web/public/css/admin/admin-statistics.css` | [FE] |
| **ISS-6** | **Medium** | 19-2 | Mobile(480px) 요약 카드 우측 overflow — 카드 너비가 뷰포트 초과 | `web/public/css/admin/admin-statistics.css` | [FE] |

#### 근본 원인 분석

**ISS-1 (Critical)**:
- Phase 19-3에서 그룹 상세 패널을 "2단계 진입" → "인라인 편집 폼"으로 전환
- `keyword-group-suggestion.js`의 `suggestKeywordsFromDescription()` 메서드가 참조하는 버튼/입력 요소의 DOM ID가 새 인라인 폼 구조와 불일치
- line 55: `this.suggestBtn.disabled = true` — `this.suggestBtn`이 null

**ISS-7 (High)**:
- `KnowledgeWorkflow` 생성자: `this.currentTab = "create"` 초기화 → `syncFromUrl()` 호출
- `syncFromUrl()`: URL에서 `?tab=create` 읽기 → `switchTab("create")` 호출
- `switchTab("create")`: line 56 `if (this.currentTab === tabName) return;` → **early return!**
- `registerTab()`: `init()` 만 호출, `activate()` 미호출
- 수정 방향: `registerTab()` 내에서 `name === this.currentTab`이면 `instance.activate()` 호출

**ISS-4 (High)**:
- `header-component.js` line 39에 "지식 워크플로우" 메뉴 추가됨
- 그러나 기존 3개 메뉴(청크 생성, 청크 승인, 청크 관리) 항목이 삭제되지 않음
- 수정 방향: 기존 3개 메뉴 항목 제거, "지식 워크플로우" 단일 메뉴만 유지

**ISS-5/6 (Medium)**:
- `admin-statistics.css`에서 `.admin-container`의 `grid-template-columns`가 고정값(px)
- 반응형 breakpoint(`@media max-width: 1200px`, `max-width: 768px`)에서 grid를 `1fr` 1열로 변경 필요

#### 예상 Task 분해 (20-0)

| Task | 도메인 | 내용 | 대상 파일 | 난이도 |
|------|:------:|------|----------|:------:|
| 20-0-1 | [FE] | ISS-1 수정: `keyword-group-suggestion.js` DOM 참조 수정 — 인라인 편집 폼의 요소 ID에 맞게 셀렉터 갱신 | `keyword-group-suggestion.js` | 낮음 |
| 20-0-2 | [FE] | ISS-7 수정: `knowledge-workflow.js` 초기 탭 activate 호출 — `registerTab()` 내 조건부 activate 또는 초기화 후 별도 호출 | `knowledge-workflow.js` | 낮음 |
| 20-0-3 | [FE] | ISS-4 수정: `header-component.js` LNB 구 메뉴 3개 삭제 — "지식 워크플로우" 단일 메뉴만 유지 | `header-component.js` | 낮음 |
| 20-0-4 | [FE] | ISS-5/6 수정: `admin-statistics.css` 반응형 grid 수정 — Tablet/Mobile breakpoint에서 `.admin-container` 1열 전환 + `.summary-cards` 100% 너비 | `admin-statistics.css` | 낮음 |
| 20-0-5 | [TEST] | 브라우저 E2E 재검증: TC-1-2, TC-4-3, TC-4-9, TC-2-3, TC-2-4 전체 PASS 확인 | 브라우저 | 낮음 |

**예상 Task 수**: 5개
**완료 기준**: 5개 이슈 모두 해소, 기존 테스트 168 passed 유지, 브라우저 E2E 23 TC 전체 PASS

---

### 2.1 선행 리팩토링 (P0) — Phase 20-1

**배경**: Phase 19 Chain 완료 후 리팩토링 레지스트리(REFACTOR-1)에 등록된 파일 중,
Phase 20의 후속 방향(청크 2단계, AI 질의, 지식구조)에서 **직접 변경 예정**인 파일이 500줄~700줄 근접 상태이다.
기능 추가 전에 분리하지 않으면 700줄 경고선 돌파가 확실하므로, **REFACTOR-2 규칙**에 따라 선행 Phase로 편성한다.

**리팩토링 규정 근거**:
- REFACTOR-2: Master Plan 작성 시 레지스트리 읽기 → 700줄 초과 시 Level별 리팩토링 편성
- 규정 §6.1: 리팩토링 대상 파일을 다음 기능 Phase에서 **수정해야 함** → **리팩토링 먼저**

#### 대상 파일 상세

| # | 파일 | 현재 | 예상 | Lv | 후속 Phase | 긴급도 |
|---|------|-----:|-----:|:--:|:----------:|:------:|
| **R1** | `backend/routers/reasoning/stream_executor.py` | **588** | **700+** | Lv1 | 20-4 (AI 질의) | **Critical** |
| **R2** | `backend/services/system/statistics_service.py` | **699** | **700+** | Lv1 | — (간접) | **Critical** |
| **R3** | `backend/routers/knowledge/labels_crud.py` | **575** | **650+** | Lv1 | 20-5 (지식구조) | High |
| **R4** | `web/public/js/reason/reason-control.js` | **498** | **550+** | Lv1 | 20-4 (AI 질의) | High |
| **R5** | `backend/routers/reasoning/reason_helpers.py` | **484** | **530+** | Lv1 | 20-4 (AI 질의) | Medium |

#### R1: `stream_executor.py` (588줄 → 700+) — Critical

**문제**: RAG 필터 로직 + 출처 추출 로직이 추가되면 700줄 확실 돌파.
**현재 구조 분석**:
- 스트림 실행 코어 (SSE 생성, 토큰 전송)
- RAG 컨텍스트 구성 (벡터 검색, 청크 조합)
- 전처리/후처리 (프롬프트 조립, 결과 파싱)

**분리안**:
| 분리 파일 | 내용 | 목표 줄 수 |
|----------|------|----------:|
| `stream_executor.py` (메인) | 스트림 실행 코어 (SSE) | ~300 |
| `rag_context_builder.py` (신규) | RAG 컨텍스트 구성 + 필터 | ~200 |
| `stream_post_processor.py` (신규) | 결과 파싱 + 출처 추출 | ~150 |

**검증**: `reason_helpers.py`(484줄)와의 의존성 확인 필요 — 단방향이면 Lv1 확정, 양방향이면 Lv2 검토.

#### R2: `statistics_service.py` (699줄 → 700+) — Critical

**문제**: 700줄 경고선 **1줄 차**. Phase 20에서 직접 변경 없으나, 간접 영향(통계 쿼리 확장 등)으로 언제든 돌파 가능.
**현재 구조 분석**:
- 다양한 도메인별 통계 집계 함수가 단일 파일에 밀집
- 각 함수는 비교적 독립적 (도메인별 분리 용이)

**분리안**:
| 분리 파일 | 내용 | 목표 줄 수 |
|----------|------|----------:|
| `statistics_service.py` (메인) | 공통 유틸 + 집계 오케스트레이션 | ~250 |
| `statistics_document.py` (신규) | 문서/청크 통계 | ~200 |
| `statistics_knowledge.py` (신규) | 지식구조/라벨/관계 통계 | ~200 |

**검증**: 다른 서비스에서 `statistics_service`를 직접 import하는 경로 확인.

#### R3: `labels_crud.py` (575줄 → 650+) — High

**문제**: 지식구조 고도화(20-5)에서 일관성 검사(중복 라벨 탐지, 순환 관계 방지) 추가 시 650줄+ 예상.
**현재 구조 분석**:
- 라벨 CRUD 엔드포인트
- 라벨 트리 조작
- 유효성 검사 로직 (현재 인라인)

**분리안**:
| 분리 파일 | 내용 | 목표 줄 수 |
|----------|------|----------:|
| `labels_crud.py` (메인) | CRUD 엔드포인트 | ~350 |
| `labels_validation.py` (신규) | 유효성 + 일관성 검사 로직 | ~250 |

**검증**: `labels_tree.py`(151줄), `labels_suggest.py`(227줄)와의 의존 방향 확인.

#### R4: `reason-control.js` (498줄 → 550+) — High

**문제**: AI 질의 고도화(20-4)에서 RAG 필터 UI + 컨텍스트 미리보기 추가 시 550줄+ 예상.
**현재 구조 분석**:
- 질의 폼 제어 (입력, 옵션 토글)
- 세션 관리 연동
- 결과 표시 트리거

**분리안**:
| 분리 파일 | 내용 | 목표 줄 수 |
|----------|------|----------:|
| `reason-control.js` (메인) | 질의 폼 제어 + 세션 연동 | ~300 |
| `reason-rag-filter.js` (신규) | RAG 필터 UI + 컨텍스트 미리보기 | ~200 |

**검증**: `reason.js`(424줄), `reason-session.js`(326줄)와의 import 관계 확인.

#### R5: `reason_helpers.py` (484줄 → 530+) — Medium

**문제**: AI 질의 고도화(20-4)에서 출처 파싱 로직 추가 시 500줄 돌파 가능.
**현재 구조 분석**:
- 프롬프트 빌더 유틸
- 응답 파싱 유틸
- 컨텍스트 포맷팅

**분리안**:
| 분리 파일 | 내용 | 목표 줄 수 |
|----------|------|----------:|
| `reason_helpers.py` (메인) | 프롬프트 빌더 + 컨텍스트 포맷팅 | ~300 |
| `reason_parsers.py` (신규) | 응답 파싱 + 출처 추출 | ~200 |

**검증**: `stream_executor.py`와의 양방향 의존 여부 — R1과 함께 조사.

#### 예상 Task 분해 (20-1)

| Task | 도메인 | 내용 | 대상 | 난이도 |
|------|:------:|------|------|:------:|
| 20-1-1 | [BE] | 영향도 조사: R1+R5 의존성 매핑 (import 그래프 + 양방향 참조 확인) | stream_executor, reason_helpers | 낮음 |
| 20-1-2 | [BE] | R1 분리: `stream_executor.py` → 코어 + `rag_context_builder.py` + `stream_post_processor.py` | stream_executor.py (588줄) | 중간 |
| 20-1-3 | [BE] | R2 분리: `statistics_service.py` → 오케스트레이션 + `statistics_document.py` + `statistics_knowledge.py` | statistics_service.py (699줄) | 중간 |
| 20-1-4 | [BE] | R3 분리: `labels_crud.py` → CRUD + `labels_validation.py` | labels_crud.py (575줄) | 중간 |
| 20-1-5 | [FE] | R4 분리: `reason-control.js` → 폼 제어 + `reason-rag-filter.js` | reason-control.js (498줄) | 중간 |
| 20-1-6 | [BE] | R5 분리: `reason_helpers.py` → 빌더 + `reason_parsers.py` | reason_helpers.py (484줄) | 낮음 |
| 20-1-7 | [TEST] | 회귀 테스트 (168 passed 유지 확인) + 레지스트리 갱신 | 전체 | 낮음 |

**예상 Task 수**: 7개
**완료 기준**: 모든 대상 파일 500줄 이하, 기존 테스트 168 passed 유지, 레지스트리 해소 이력 기록

---

### 2.2 청크 관리 2단계 (P1) — Phase 20-2

**배경**: Phase 19-4에서 탭 기반 통합(1단계) 완료. 사용자 리뷰 게이트 후 2단계 편성 프로토콜에 따라 진행.

**19-4 리뷰 게이트 체크**:
- [x] 1단계 완성도: 탭 전환/다중 선택/일괄 작업 — G4 PASS (168 passed)
- [ ] UX 피드백: 실사용 결과 기반 개선 요구사항 수집 **필요**
- [ ] 2단계 스코프 조정: Stepper/빠른 생성+승인/자동 승인 규칙 재검토 **필요**

**핵심 기능**:

| 기능 | 설명 | 도메인 | 난이도 |
|------|------|--------|:------:|
| Stepper UI 전환 | 탭 → Stepper (1→2→3 순차 진행) | [FE] | 중간 |
| "빠른 생성+승인" 워크플로우 | 파일 드롭 → AI 분석 → 자동 라벨 → 승인 | [FS] | 높음 |
| 조건부 자동 승인 규칙 | 신뢰도 기반 자동/수동 승인 분기 | [BE] | 높음 |
| 진행률 표시 | 빠른 모드 실행 시 단계별 진행 표시 | [FE] | 낮음 |
| Bulk API | 일괄 승인/라벨 API (FE 루프 → BE 일괄 처리) | [BE] | 중간 |

**리스크**:
- 자동 승인 신뢰도 기준 미정 (심각도: 높음)
- Stepper에서 사용자 자유 탐색 제한 (중간)
- 빠른 모드 실패 시 복구 UX (높음)

**예상 Task 수**: 5~6개

---

### 2.3 검색 고도화 (P1) — Phase 20-3

**배경**: 현재 하이브리드 검색(키워드+벡터 RRF)은 동작하나, 고급 필터/결과 설명/성능이 부족.

**1단계 스코프 (Phase 20 범위)**:

| 기능 | 설명 | 도메인 | 난이도 |
|------|------|--------|:------:|
| 고급 필터 UI | 라벨/프로젝트/승인상태/날짜 결합 필터 | [FS] | 중간 |
| 결과 근거 표시 | 매칭 타입(키워드/벡터/하이브리드) + 스코어 표시 | [FS] | 중간 |
| GIN 인덱스 적용 | `knowledge_chunks.content` 키워드 검색 성능 향상 | [DB] | 낮음 |
| 검색 → AI 질의 연계 | 검색 결과 선택 → AI 질의 컨텍스트로 전달 | [FS] | 높음 |

**2/3단계 (Phase 20 이후)**:
- 검색 품질 모드(정밀/균형/광범위)
- Boolean 쿼리
- 검색 캐시
- RBAC + 민감도 등급 필터

**예상 Task 수**: 4~5개

---

### 2.4 AI 질의 고도화 (P1) — Phase 20-4

**배경**: 현재 로컬 LLM(Ollama) 기반 AI 질의는 출처/근거 표시 부족, RAG 범위 제어 불가.

**1단계 스코프 (Phase 20 범위)**:

| 기능 | 설명 | 도메인 | 난이도 |
|------|------|--------|:------:|
| 답변 출처/근거 표시 | 참조 청크 링크 + 관련도 표시 | [FS] | 중간 |
| RAG 컨텍스트 필터 UI | 라벨/프로젝트/승인상태로 RAG 범위 제한 | [FS] | 중간 |
| 컨텍스트 미리보기 | RAG 결과 청크를 질의 전 확인/편집 | [FE] | 중간 |
| 검색 결과 → AI 질의 전달 | 검색에서 선택한 청크를 컨텍스트로 주입 | [FS] | 높음 |

**2/3단계 (Phase 20 이후)**:
- 대화 폴더/태그/내보내기
- 민감 정보 자동 차단 정책
- 공유 링크(만료/권한)

**예상 Task 수**: 4~5개

---

### 2.5 지식구조 고도화 (P2) — Phase 20-5

**배경**: 라벨/관계/승인 프로세스가 분리되어 관리 가능하나, 이력 통합 뷰 부재, 일관성 검사 미흡.

**1단계 스코프 (Phase 20 범위)**:

| 기능 | 설명 | 도메인 | 난이도 |
|------|------|--------|:------:|
| 승인/라벨 변경 이력 타임라인 | 청크별 이력 뷰 (생성→승인→라벨 변경) | [FS] | 중간 |
| 라벨/관계 일관성 검사 | 중복 라벨 탐지 + 순환 관계 방지 | [BE] | 중간 |
| 지식 구조 → AI 질의 연계 | 선택 청크 기반 AI 질의 진입 | [FE] | 중간 |

**2/3단계 (Phase 20 이후)**:
- RBAC 역할 기반 접근 제어
- 변경 diff + 롤백(버전 관리)
- 관계 타입 확장(근거, 반례, 인용)
- 감사 로그 뷰 + 내보내기

**예상 Task 수**: 3~4개

---

### 2.6 AI 대화 UX 리뉴얼 (P2) — Phase 20-6

**배경**: `/ask` 페이지가 앱 내 **가장 낙후된 UX**. Q&A를 단순 로그형으로 나열하며, 스트리밍 없음, 대화 세션 개념 없음, 답변별 액션(복사/평가/공유) 없음. 반면 `/reason` (Reasoning Lab)은 SSE 스트리밍·세션 관리·페이지네이션·모드 선택까지 갖추고 있어 동일 앱 내 UX 격차가 큼.

**현 상태 분석**:
- `web/public/js/ask.js` — 단순 fetch → 결과 append 구조
- `web/src/pages/ask.html` — 56줄의 최소 마크업
- Reasoning Lab의 SSE 인프라(`stream_executor.py`, `reason-session.js`) 재사용 가능
- `/api/ai` 응답에 `context_chunks[]` 배열 존재하나 FE 미렌더링
- `/api/conversations` 대화 이력 API 존재하나 FE 연동 최소

**20-4와의 차이**: 20-4는 "데이터 품질"(출처·RAG 필터), 20-6은 "인터랙션 품질"(Chat UI·스트리밍·세션)

**1단계 스코프 (Phase 20 범위)**:

| 기능 | 설명 | 도메인 | 난이도 |
|------|------|--------|:------:|
| 채팅 버블 UI | 사용자/AI 메시지 시각 분리 + 타임스탬프 + 아바타 | [FE] | 낮음 |
| SSE 스트리밍 답변 | `/api/ai` 응답을 토큰 단위 실시간 표시 (Reasoning Lab 패턴 재사용) | [FS] | 중간 |
| 대화 세션 관리 | 세션 목록 사이드바 + 새 대화/이어가기 + 세션 제목 자동 생성 | [FS] | 중간 |
| 답변별 액션 | 복사/Markdown 내보내기/출처 펼치기/피드백(좋음/나쁨) | [FE] | 낮음 |
| 대화 내보내기 | 세션 단위 Markdown/JSON 다운로드 | [FS] | 낮음 |

**2/3단계 (Phase 20 이후)**:
- 대화 폴더/태그 분류
- 공유 링크(만료/권한)
- 음성 입력/TTS 출력

**리팩토링 사전 점검**:
- `ask.js` (현재 소규모) — 채팅 UI 전환 시 모듈 분리 설계 필요: `ask-chat.js` + `ask-session.js` + `ask-stream.js`
- Reasoning Lab의 `reason-session.js`(326줄), `reason-render.js`(254줄) 패턴 참조하여 공통 컴포넌트 추출 가능
- `stream_executor.py` → 20-1(R1)에서 분리 완료 후 확장

**예상 Task 수**: 5~6개
**완료 기준**: `/ask` 페이지에서 SSE 스트리밍 채팅, 세션 목록 사이드바, 답변별 복사/출처/피드백 동작

---

### 2.7 코그니티브 대시보드 (P2) — Phase 20-7

**배경**: 백엔드에 **5개 코그니티브 모듈**이 **20+ API 엔드포인트**로 구현되어 있으나, **프론트엔드 UI가 전무**. 앱 이름이 "Personal AI **Brain**"인데 두뇌의 인지 능력을 사용자가 볼 수 없는 상태.

**기존 BE API 인벤토리**:

| 모듈 | 라우터 | 엔드포인트 수 | 설명 |
|------|--------|:-----------:|------|
| Memory | `backend/routers/cognitive/memory.py` | 5+ | 장기/단기/작업 기억 저장·조회·삭제 |
| Context | `backend/routers/cognitive/context.py` | 4+ | 문서 간 연결 이해·참조 추출 |
| Learning | `backend/routers/cognitive/learning.py` | 4+ | 사용자 패턴 분석·관심사 추적 |
| Personality | `backend/routers/cognitive/personality.py` | 3+ | 사용자 선호도 모델·응답 스타일 조정 |
| Metacognition | `backend/routers/cognitive/metacognition.py` | 4+ | 확신도/불확실도 분석·자기 평가 |

**1단계 스코프 (Phase 20 범위)**:

| 기능 | 설명 | 도메인 | 난이도 |
|------|------|--------|:------:|
| 코그니티브 대시보드 페이지 | `/cognitive` 신규 페이지 — 5개 모듈 통합 뷰 | [FE] | 중간 |
| 메모리 뷰어 | 장기/단기/작업 기억 목록 + 검색 + 시간순 타임라인 | [FE] | 중간 |
| 학습 인사이트 카드 | "최근 관심사", "자주 질문하는 주제", "활동 패턴" 시각화 | [FE] | 낮음 |
| 메타인지 지표 | AI 확신도/불확실도 게이지 — 최근 답변 신뢰도 트렌드 | [FE] | 낮음 |
| LNB 메뉴 추가 | 사용자 메뉴에 "🧠 AI Brain" 항목 추가 | [FE] | 낮음 |

**2/3단계 (Phase 20 이후)**:
- 퍼스널리티 프로필 편집 UI (응답 톤·상세도·언어 선호)
- 컨텍스트 맵 시각화 (문서 간 연결을 AI가 어떻게 이해하는지)
- 메모리 수동 편집/삭제 (사용자가 AI 기억 관리)
- 학습 리셋/편향 교정

**리팩토링 사전 점검**:
- FE 신규 생성 — `web/public/js/cognitive/` 디렉토리, 모듈별 분리 설계
- BE API 기존 완성 → FE 연동만으로 가시적 결과 도출
- 대시보드 특성상 Chart.js 재사용 (`/admin/statistics`에서 사용 중)

**예상 Task 수**: 4~5개
**완료 기준**: `/cognitive` 페이지에서 5개 모듈 데이터 조회·표시, LNB 메뉴 정상 노출

---

### 2.8 지식 그래프 인터랙티브 탐색 (P2) — Phase 20-8

**배경**: D3.js 기반 force-directed 그래프(`/knowledge-graph`)가 존재하나, 노드가 "Chunk #56" 등 **제너릭 라벨만 표시**. 컬러코딩 없음, 필터 없음, 클릭 시 상세 없음. 78노드/50링크로 **정보 가치 거의 없는 프로토타입 수준**.

**현 상태 분석**:
- `web/public/js/knowledge/knowledge-graph.js` — D3.js force-directed 기본 구현
- `backend/routers/knowledge/graph.py` — 노드/링크 데이터 API
- 노드 수 제한(100), 최소 신뢰도 슬라이더(0.0), 새로고침 버튼만 존재
- 20-5(지식구조 일관성)에서 관계 품질 확보 → 그래프 탐색 가치 극대화 **시너지**

**1단계 스코프 (Phase 20 범위)**:

| 기능 | 설명 | 도메인 | 난이도 |
|------|------|--------|:------:|
| 시맨틱 노드 라벨 | 청크 제목/키워드 기반 의미 있는 라벨 + 라벨 유형별 컬러 코딩 | [FS] | 중간 |
| 인터랙티브 탐색 | 노드 클릭 → 청크 미리보기 패널, 더블클릭 → 관계 확장, 호버 → 연결 하이라이트 | [FE] | 중간 |
| 필터 패널 | 프로젝트/라벨/관계타입/시간범위 필터 + 깊이(hop) 제어 | [FS] | 중간 |
| 클러스터 시각화 | 라벨 기반 자동 그룹핑 + 주제별 색상 영역 표시 | [FE] | 높음 |
| 그래프 → AI 질의 연계 | 선택한 노드 그룹을 AI 질의 컨텍스트로 전달 | [FS] | 중간 |

**2/3단계 (Phase 20 이후)**:
- 커뮤니티 감지 알고리즘 (Louvain/Label Propagation)
- 시간축 애니메이션 (지식 성장 과정 재생)
- 그래프 내보내기 (PNG/SVG/JSON)
- 관계 타입별 엣지 스타일 분화

**리팩토링 사전 점검**:
- `knowledge-graph.js` (현재 소규모) — 인터랙션 추가 시 모듈 분리: `graph-core.js` + `graph-filters.js` + `graph-interactions.js`
- `graph.py` API 확장: 시맨틱 라벨 필드 추가, 필터 파라미터 확장
- D3.js v7 기존 사용 중 — 추가 라이브러리 불필요

**예상 Task 수**: 4~5개
**완료 기준**: 노드에 시맨틱 라벨 + 컬러코딩, 클릭 시 청크 미리보기, 필터 패널 동작, 선택 → AI 질의 연계

---

## 3. 리팩토링 대상 — 1단계 우선순위 (REFACTOR-2)

Phase 20에서 변경/확장되는 파일의 현재 줄 수를 스캔하여, 500줄/700줄 돌파 가능성을 사전 식별한다.

### 등급 기준

| 등급 | 기준 | 의미 |
|:----:|------|------|
| `!!!` | 700줄 초과 예상 | **Lv1/Lv2 리팩토링 필수** — Master Plan에 선행 Task 편성 |
| `!!` | 500줄 초과 예상 | **모듈 분리 설계** — 기능 추가 전 분리 방안 확정 |
| `!` | 400~500줄 (경계) | **변경 시 줄 수 확인** — 500줄 돌파 시 레지스트리 등록 |
| `-` | 400줄 미만 | 안전 |

---

### 3.1 리팩토링 필수/검토 대상 종합 (우선순위순)

| 순위 | 등급 | 파일 | 현재 | 예상 | 관련 방향 | 조치 |
|:----:|:----:|------|-----:|-----:|:---------:|------|
| **1** | `!!!` | `backend/routers/reasoning/stream_executor.py` | **588** | **700+** | AI 질의 (20-4) | **20-1에서 선행 분리 완료** (R1) |
| **2** | `!!!` | `backend/services/system/statistics_service.py` | **699** | **700+** | — (간접) | **20-1에서 선행 분리 완료** (R2) |
| **3** | `!!` | `backend/routers/knowledge/labels_crud.py` | **575** | **650+** | 지식구조 (20-5) | **20-1에서 선행 분리 완료** (R3) |
| **4** | `!!` | `web/public/js/reason/reason-control.js` | **498** | **550+** | AI 질의 (20-4) | **20-1에서 선행 분리 완료** (R4) |
| **5** | `!!` | `web/public/js/admin/knowledge-workflow.js` | **220** | **500+** | 청크 2단계 (20-2) | Stepper + 빠른 모드 + 상태 관리 → 20-2에서 모듈 분리 설계 (REFACTOR-3) |
| **6** | `!` | `backend/routers/reasoning/reason_helpers.py` | **484** | **530?** | AI 질의 (20-4) | **20-1에서 선행 분리 완료** (R5) |
| **7** | `!` | `web/public/js/admin/label-manager.js` | **469** | **500?** | 청크 2단계 (20-2) | 자동 라벨 연동 확장 범위에 따라 |
| **8** | `!` | `web/public/js/admin/chunk-create.js` | **468** | **500?** | 청크 2단계 (20-2) | 빠른 생성 모드를 별도 모듈로 분리 |
| **9** | `!` | `web/public/css/admin/admin-chunk-create.css` | **450** | **500?** | 청크 2단계 (20-2) | Stepper CSS 추가 시 |
| **10** | `!` | `backend/services/knowledge/folder_service.py` | **480** | **520?** | 지식구조 (20-5) | 이력 관리 확장 가능성 |
| **11** | `!` | `backend/routers/knowledge/document_handlers.py` | **458** | — | 지식구조 (20-5) | 직접 변경 적으면 안전 |

---

### 3.2 방향별 리팩토링 대상 파일 전체 목록

#### 청크 관리 2단계 (20-2) — `/admin/knowledge-workflow`

| 파일 | 줄 수 | 등급 | 변경 내용 |
|------|------:|:----:|----------|
| `web/public/js/admin/knowledge-workflow.js` | 220 | `!!` | Stepper 로직 + 빠른 모드 + 상태 관리 → **모듈 분리** |
| `web/public/js/admin/label-manager.js` | 469 | `!` | 자동 라벨 연동 확장 |
| `web/public/js/admin/chunk-create.js` | 468 | `!` | 빠른 생성 모드 추가 |
| `web/public/css/admin/admin-chunk-create.css` | 450 | `!` | Stepper CSS 추가 |
| `web/src/pages/admin/knowledge-workflow.html` | 347 | `-` | Stepper 마크업 |
| `web/public/js/admin/chunk-approval-manager.js` | 322 | `-` | 자동 승인 연동 |
| `web/public/css/admin/admin-chunk-labels.css` | 324 | `-` | |
| `backend/routers/knowledge/knowledge.py` | 298 | `-` | Bulk API 추가 가능 |
| `backend/routers/knowledge/suggestions.py` | 283 | `-` | 자동 라벨 확장 |
| `backend/routers/knowledge/approval.py` | 231 | `-` | 자동 승인 규칙 |
| `web/public/js/admin/chunk-approval-api.js` | 148 | `-` | |
| `web/public/js/admin/admin-approval.js` | 74 | `-` | |

#### 검색 고도화 (20-3) — `/search`

| 파일 | 줄 수 | 등급 | 변경 내용 |
|------|------:|:----:|----------|
| `web/public/css/search.css` | 406 | `!` | 고급 필터 UI CSS |
| `backend/services/search/hybrid_search.py` | 347 | `-` | GIN 인덱스 + 스코어 반환 |
| `backend/routers/search/documents.py` | 300 | `-` | 필터 파라미터 확장 |
| `backend/services/search/search_service.py` | 288 | `-` | 고급 필터 로직 |
| `backend/routers/search/search.py` | 272 | `-` | 필터 API 확장 |
| `backend/services/search/document_sync_service.py` | 241 | `-` | |
| `backend/services/search/multi_hop_rag.py` | 208 | `-` | AI 질의 연계 시 확장 |
| `backend/services/search/reranker.py` | 117 | `-` | |
| `web/src/pages/search.html` | 63 | `-` | 필터 UI 마크업 |
| `web/public/js/search.js` | **(미존재)** | — | **신규 생성** — 500줄 초과 사전 방지 설계 필요 |

#### AI 질의 고도화 (20-4) — `/ask` (reason 기반)

| 파일 | 줄 수 | 등급 | 변경 내용 |
|------|------:|:----:|----------|
| `backend/routers/reasoning/stream_executor.py` | **588** | `!!!` | RAG 필터 + 출처 추출 → **700줄 돌파 예상, 선행 분리** |
| `web/public/js/reason/reason-control.js` | **498** | `!!` | RAG 필터 UI + 컨텍스트 미리보기 |
| `backend/routers/reasoning/reason_helpers.py` | **484** | `!` | 출처 파싱 로직 추가 |
| `web/public/js/reason/reason.js` | 424 | `!` | 검색 → AI 질의 연계 |
| `backend/routers/reasoning/reason_store.py` | 399 | `-` | 출처 저장 확장 |
| `web/public/js/reason/reason-steps.js` | 364 | `-` | |
| `web/public/js/reason/reason-session.js` | 326 | `-` | |
| `backend/routers/reasoning/reason_document.py` | 284 | `-` | |
| `web/public/js/reason/reason-render.js` | 254 | `-` | 출처 링크 렌더링 |
| `web/public/js/reason/reason-render-viz.js` | 261 | `-` | |
| `web/public/css/ask.css` | 161 | `-` | |
| `web/src/pages/ask.html` | 56 | `-` | |

#### 지식구조 고도화 (20-5) — `/knowledge`

| 파일 | 줄 수 | 등급 | 변경 내용 |
|------|------:|:----:|----------|
| `backend/routers/knowledge/labels_crud.py` | **575** | `!!` | 일관성 검사 추가 → 별도 모듈 분리 |
| `backend/services/knowledge/folder_service.py` | **480** | `!` | 이력 관리 확장 가능 |
| `backend/routers/knowledge/document_handlers.py` | **458** | `!` | |
| `backend/routers/knowledge/folder_management.py` | 452 | `!` | |
| `backend/routers/knowledge/knowledge_handlers.py` | 380 | `-` | 이력 타임라인 API |
| `backend/services/knowledge/structure_matcher.py` | 350 | `-` | |
| `backend/routers/knowledge/labels.py` | 309 | `-` | |
| `backend/routers/knowledge/relations.py` | 249 | `-` | 순환 관계 검사 추가 |
| `web/public/css/knowledge-tree.css` | 239 | `-` | |
| `backend/routers/knowledge/labels_suggest.py` | 227 | `-` | |
| `backend/services/knowledge/knowledge_integration_service.py` | 190 | `-` | |
| `backend/services/knowledge/chunk_sync_service.py` | 199 | `-` | |

---

### 3.3 기존 레지스트리 등록 파일 — Phase 20 영향도

| 파일 | 줄 수 | Phase 20 영향 | 조치 |
|------|------:|:------------:|--------|
| `statistics_service.py` | **699** | 간접 (700줄 1줄 차) | **20-1(R2)에서 선행 분리** |
| `stream_executor.py` | **588** | **직접 변경** (20-4 AI 질의) | **20-1(R1)에서 선행 분리** |
| `labels_crud.py` | **575** | **직접 변경** (20-5 지식구조) | **20-1(R3)에서 선행 분리** |
| `keyword-group-matching.js` | 557 | 미관련 | 유지 (모니터링) |
| `automation.py` | 542 | 미관련 | 유지 (모니터링) |
| `settings-common.css` | 534 | 미관련 | 유지 (모니터링) |

---

### 3.4 리팩토링 조치 요약

**Phase 20-1 (선행 리팩토링)에서 해소**:

| # | 파일 | 현재 → 목표 | 분리안 |
|---|------|:-----------:|--------|
| R1 | `stream_executor.py` | 588 → 300+200+150 | 코어 + `rag_context_builder.py` + `stream_post_processor.py` |
| R2 | `statistics_service.py` | 699 → 250+200+200 | 오케스트레이션 + `statistics_document.py` + `statistics_knowledge.py` |
| R3 | `labels_crud.py` | 575 → 350+250 | CRUD + `labels_validation.py` |
| R4 | `reason-control.js` | 498 → 300+200 | 폼 제어 + `reason-rag-filter.js` |
| R5 | `reason_helpers.py` | 484 → 300+200 | 빌더 + `reason_parsers.py` |

**후속 Phase에서 REFACTOR-3 (사전 방지) 적용**:
- `knowledge-workflow.js` (220줄 → 500+) — 20-2에서 모듈 분리 설계: `knowledge-workflow-stepper.js` + `knowledge-workflow-quick.js`
- `search.js` (신규) — 20-3에서 500줄 초과 방지 설계

---

## 4. 의존성 분석

```
Phase 19 핫픽스 (P0) — 20-0
  └─ 독립 실행 (FE 버그 수정 5건, 기능 추가 없음)
  └─ 19-1 ISS-1: keyword-group-suggestion.js DOM 참조 수정
  └─ 19-4 ISS-7: knowledge-workflow.js 초기 탭 activate 호출
  └─ 19-4 ISS-4: header-component.js LNB 구 메뉴 삭제
  └─ 19-2 ISS-5/6: admin-statistics.css 반응형 grid 수정
  └─ 완료 기준: 168 passed 유지 + 브라우저 E2E 23 TC ALL PASS

선행 리팩토링 (P0) — 20-1
  └─ 20-0 완료 후 시작 (ISS-1 수정된 코드 기반)
  └─ 후속 모든 Phase의 코드 품질 기반
  └─ 완료 기준: 168 passed 유지 + 대상 파일 500줄 이하

청크 관리 2단계 (P1) — 20-2
  └─ 20-1 완료 후 시작 (직접 의존 없으나 리팩토링 선행 권장)
  └─ 독립 실행 가능 (19-4 기반 확장, 20-0에서 ISS-7/ISS-4 해소 전제)
  └─ 19-1 키워드 추천 완료 → 자동 라벨 품질 확보 ✓

검색 고도화 (P1) — 20-3
  └─ 20-1 완료 필수 (search.js 신규 생성 시 REFACTOR-3 적용)
  └─ "검색 → AI 질의 연계"는 AI 질의 고도화와 교차 의존
  └─ GIN 인덱스는 독립 적용 가능

AI 질의 고도화 (P1) — 20-4
  └─ **20-1 완료 필수** (stream_executor, reason_helpers, reason-control 분리 선행)
  └─ "출처 표시"는 독립 구현 가능
  └─ "검색 → AI 질의 전달"은 검색 고도화와 교차 의존
  └─ "컨텍스트 필터"는 검색 필터와 공통 컴포넌트 가능

지식구조 고도화 (P2) — 20-5
  └─ **20-1 완료 필수** (labels_crud 분리 선행)
  └─ "이력 타임라인"은 독립 구현 가능
  └─ "지식 → AI 질의 연계"는 AI 질의 고도화와 교차 의존

AI 대화 UX 리뉴얼 (P2) — 20-6
  └─ **20-1 완료 권장** (stream_executor 분리 후 SSE 확장 용이)
  └─ 20-4 (AI 질의)와 시너지 — 20-4의 출처/RAG 필터 데이터를 Chat UI에서 렌더링
  └─ Reasoning Lab 패턴(reason-session.js, SSE) 재사용 → 독립 구현 가능
  └─ ask.js 소규모이므로 리팩토링 부담 없음

코그니티브 대시보드 (P2) — 20-7
  └─ **독립 실행 가능** (BE API 5개 모듈 완성, FE 신규 생성)
  └─ 20-1 이후 어느 시점에든 착수 가능
  └─ Chart.js 재사용 (/admin/statistics에서 사용 중)
  └─ 다른 Phase와의 의존성 없음

지식 그래프 인터랙티브 탐색 (P2) — 20-8
  └─ **20-5 완료 후 권장** (관계 품질 확보 → 그래프 탐색 가치 극대화)
  └─ D3.js v7 기존 사용, knowledge-graph.js 소규모이므로 확장 용이
  └─ graph.py API 확장 필요 (시맨틱 라벨 필드, 필터 파라미터)
  └─ "그래프 → AI 질의 연계"는 20-4/20-6과 교차 의존
```

### 의존성 다이어그램

```
20-0 (Phase 19 핫픽스)
  │
  └──→ 20-1 (선행 리팩토링)
        │
        ├──→ 20-2 (청크 2단계) — 직접 의존 없음, 순서상 후행
        │
        ├──→ 20-3 (검색) — REFACTOR-3 적용
        │
        ├──→ 20-4 (AI 질의) — ★ 필수 선행 (R1, R4, R5 분리)
        │     │
        │     └──→ 20-6 (AI Chat UX) — 20-4 출처/필터 데이터 활용 시너지
        │
        ├──→ 20-5 (지식구조) — ★ 필수 선행 (R3 분리)
        │     │
        │     └──→ 20-8 (지식 그래프) — 20-5 관계 품질 확보 후 가치 극대화
        │
        └──→ 20-7 (코그니티브) — 독립 실행 가능 (BE 완성)

20-3 (검색) ←→ 20-4 (AI 질의)  — 교차 의존 (컨텍스트 전달)
20-4 (AI 질의) ←→ 20-5 (지식구조) — 교차 의존 (AI 질의 연계)
20-6 (AI Chat) ←→ 20-4 (AI 질의) — 시너지 (출처 렌더링, SSE 공유)
20-8 (그래프) ←→ 20-6 (AI Chat) — 교차 의존 (그래프 → AI 질의 연계)
```

### 교차 의존 정리

```
[공통 기능: 메뉴 간 연계]
  검색 → AI 질의 전달 (검색 + AI 질의 교차)
  지식구조 → AI 질의 전달 (지식구조 + AI 질의 교차)
  지식 그래프 → AI 질의 전달 (그래프 + AI Chat 교차)
  → 공통 "컨텍스트 전달 인터페이스" 설계 필요

[공통 기능: 필터 통합]
  검색 필터 (라벨/프로젝트/승인상태)
  AI 질의 RAG 필터 (라벨/프로젝트/승인상태)
  지식 그래프 필터 (프로젝트/라벨/관계타입/시간범위)
  → 공통 "필터 컴포넌트" 추출 가능

[공통 기능: SSE 스트리밍]
  Reasoning Lab SSE (기존)
  AI Chat SSE (20-6 신규)
  → 공통 "SSE 클라이언트 모듈" 추출 가능

[공통 기능: 차트/시각화]
  통계 차트 (Chart.js, 기존)
  코그니티브 대시보드 (Chart.js, 20-7 신규)
  → Chart.js 공통 유틸 재사용
```

---

## 5. Phase Chain 구성 제안

### 안 A: 9개 Sub-phase (전체 순차 실행) — 권장

| Phase | 내용 | 예상 Task | 의존성 | 우선순위 |
|-------|------|:---------:|--------|:--------:|
| **20-0** | **Phase 19 핫픽스** (브라우저 E2E 이슈 5건) | 5 | 독립 (최최우선) | **P0** |
| **20-1** | **선행 리팩토링** (R1~R5 파일 분리) | 7 | 20-0 완료 후 | **P0** |
| **20-2** | 청크 관리 2단계 (Stepper + 빠른 모드) | 5~6 | 20-1 완료 후 | P1 |
| **20-3** | 검색 고도화 (필터 + 근거 표시 + GIN) | 4~5 | 20-1 완료 후 | P1 |
| **20-4** | AI 질의 고도화 (출처 + RAG 필터 + 연계) | 4~5 | **20-1 필수** + 20-3 연계 | P1 |
| **20-5** | 지식구조 고도화 (이력 + 일관성 + 연계) | 3~4 | **20-1 필수** + 20-4 연계 | P2 |
| **20-6** | AI 대화 UX 리뉴얼 (Chat UI + SSE + 세션) | 5~6 | 20-4 시너지 (독립 가능) | P2 |
| **20-7** | 코그니티브 대시보드 (Memory·Learning 통합 뷰) | 4~5 | **독립** (BE 완성) | P2 |
| **20-8** | 지식 그래프 인터랙티브 탐색 (시맨틱 라벨 + 필터) | 4~5 | 20-5 권장 + 20-6 연계 | P2 |

```
20-0 (P19 핫픽스) → 20-1 (리팩토링) → 20-2 (청크 2단계) → 20-3 (검색) → 20-4 (AI 질의) → 20-5 (지식구조) → 20-6 (AI Chat) → 20-7 (코그니티브) → 20-8 (그래프)
  [FE 버그 5건]      [코드 분리 5건]     [FS 워크플로우]      [FS 필터+성능]    [FS 출처+연계]     [FS 이력+품질]     [FE Chat UX]      [FE 대시보드]       [FS 시각화]
```

**총 예상 Task 수**: 42~48개

### 안 B: 7개 Sub-phase (검색+AI질의 병합 + 코그니티브 선행)

| Phase | 내용 | 예상 Task | 의존성 | 우선순위 |
|-------|------|:---------:|--------|:--------:|
| **20-0** | **Phase 19 핫픽스** (브라우저 E2E 이슈 5건) | 5 | 독립 (최최우선) | **P0** |
| **20-1** | **선행 리팩토링** (R1~R5 파일 분리) | 7 | 20-0 완료 후 | **P0** |
| **20-2** | 청크 관리 2단계 (Stepper + 빠른 모드) | 5~6 | 20-1 완료 후 | P1 |
| **20-3** | 검색 + AI 질의 통합 고도화 (필터/출처/연계) | 6~7 | **20-1 필수** | P1 |
| **20-4** | 지식구조 고도화 (이력 + 일관성 + 연계) | 3~4 | **20-1 필수** + 20-3 완료 후 | P2 |
| **20-5** | AI Chat UX + 코그니티브 대시보드 (FE 중심 2-in-1) | 8~10 | 20-3 시너지 | P2 |
| **20-6** | 지식 그래프 인터랙티브 탐색 | 4~5 | 20-4 권장 | P2 |

**장점**: 검색 → AI 질의 연계를 한 Phase에서 처리, 교차 의존 해소. 코그니티브+Chat을 FE 집중 Phase로 통합.
**단점**: 20-3과 20-5의 Task 수 비대화 (6~7개, 8~10개)

---

## 6. 우선순위 근거

### P0: 선행 리팩토링 (20-1)

- `statistics_service.py` **699줄** — 경고선 1줄 차, 언제든 돌파 가능
- `stream_executor.py` **588줄** — 20-4(AI 질의)에서 기능 추가 시 **700줄 확정 돌파**
- REFACTOR-2 규정: 다음 기능 Phase에서 **수정해야 하는 파일** → **리팩토링 먼저**
- 리팩토링 없이 기능 추가 시 merge conflict, 코드 복잡도 폭증, 유지보수 비용 급증
- 기존 테스트 168 passed를 유지하면서 **안전한 구조 분리**가 핵심

### P1: 청크 관리 2단계 (20-2)

- 19-4 리뷰 게이트에서 2단계 편성이 **예정된 프로토콜**
- Stepper + 빠른 모드는 사용자 체감 효율 **93% 단축** 예상
- 19-1 키워드 추천 고도화 완료로 자동 라벨 품질 확보 상태

### P1: 검색 + AI 질의 (20-3, 20-4)

- 검색 결과 근거/출처 부재 → 사용자 **신뢰도 저하** (보고서 공통 지적)
- RAG 범위 미제어 → **민감 지식 혼입** 리스크 (보안 이슈)
- 검색-AI 질의 연계는 PAB의 **핵심 사용자 경험 연결고리**
- 20-1 리팩토링으로 `stream_executor`, `reason-control` 분리 완료 → 기능 추가 용이

### P2: 지식구조 (20-5)

- 이력/감사 기능은 **운영 품질 향상** (급하지 않으나 중요)
- 라벨/관계 일관성은 **지식 그래프 품질** 장기 투자
- 20-1 리팩토링으로 `labels_crud` 분리 완료 → 일관성 검사 추가 용이

### P2: AI 대화 UX 리뉴얼 (20-6)

- `/ask` 페이지가 앱 내 **가장 낙후된 UX** — 사용자 체감 품질 직결
- 20-4(출처/RAG 필터)의 **데이터 품질 개선**을 Chat UI에서 **시각적으로 활용** → 20-4 투자 효과 극대화
- Reasoning Lab SSE 인프라 재사용 → **구현 비용 대비 효과 최고** (패턴 복제)
- P1이 아닌 이유: 현재 `/ask`가 "동작은 함" → 사용성은 떨어지나 기능 자체는 가용

### P2: 코그니티브 대시보드 (20-7)

- PAB 핵심 차별화 요소 — "개인 AI 두뇌" 제품 정체성 실현
- **BE 5개 모듈 완성** 상태 → FE 개발만으로 가시적 결과 도출 (ROI 최고)
- 다른 Phase와 **의존성 없음** → 일정 유연성 확보, 어느 시점에든 착수 가능
- P1이 아닌 이유: 핵심 사용 흐름(검색→AI질의→지식관리)에 직접 포함되지 않음

### P2: 지식 그래프 탐색 (20-8)

- 20-5(지식구조 일관성)에서 **관계 품질 확보 후** 그래프 탐색 가치 극대화 → **20-5 후행 권장**
- 기존 D3.js 프로토타입 확장 — 78노드/50링크에서 **의미 있는 탐색 도구**로 전환
- "그래프 → AI 질의 연계"로 지식 **발견(Discovery)** 경험 제공 → 20-4/20-6과 시너지
- P1이 아닌 이유: 프로토타입이 "동작은 함" + 20-5 관계 품질이 전제 조건

---

## 7. 기술 검토 사항

### 7.1 선행 리팩토링 (20-1)

- **영향도 조사 우선**: R1(`stream_executor`) ↔ R5(`reason_helpers`) 양방향 참조 여부를 먼저 확인
  - 양방향이면 Lv2 검토 필요 → 사용자 승인 후 진행
  - 단방향이면 Lv1 확정 → 독립 분리
- **R2(`statistics_service`)**: 도메인별(문서/지식/시스템) 통계 함수가 독립적이므로 분리 난이도 낮음
- **분리 원칙**: 기능 변경 없이 파일 분리만 수행 (동작 변경 금지)
- **테스트 전략**: 각 분리 Task 완료 후 즉시 `pytest tests/ -v` 실행하여 168 passed 유지 확인
- **import 경로 갱신**: 분리 파일의 import 경로 변경 시 다른 파일에서의 참조도 일괄 갱신

### 7.2 청크 관리 2단계 (20-2)

- `knowledge-workflow.js` (Phase 19-4에서 생성) 확장 — 500줄 초과 사전 방지
- Stepper 컴포넌트: 기존 탭 구조에서 `canGoBack`/`canGoForward` 제어 추가
- 빠른 모드 BE: 기존 API 조합 (create → auto-label → approve) 또는 새 엔드포인트
- 자동 승인 규칙: 관리자 설정 UI 필요 (신뢰도 임계값, 문서 유형별 분기)

### 7.3 검색 고도화 (20-3)

- 기존 `/api/search/hybrid` 확장 — 필터 파라미터 추가
- GIN 인덱스: `CREATE INDEX idx_chunks_content_gin ON knowledge_chunks USING gin(to_tsvector('simple', content))`
- 결과 설명: 기존 RRF 스코어를 FE에 전달 (현재 BE에서 계산만 하고 미반환 가능성 확인)
- 검색 → AI 질의: URL 쿼리 `?context_chunks=id1,id2` 또는 sessionStorage 활용

### 7.4 AI 질의 고도화 (20-4)

- 기존 `/api/ask` 응답에 `sources[]` 필드 추가 (참조 청크 ID + 관련도)
- RAG 필터: 기존 Qdrant 검색 파라미터에 라벨/프로젝트 조건 추가
- 컨텍스트 미리보기: AI 질의 전 RAG 결과를 FE에서 표시 → 사용자 편집 → 최종 전송

### 7.5 지식구조 고도화 (20-5)

- 이력 타임라인: `chunk_history` 테이블 신규 또는 기존 `approval_logs` 확장
- 라벨 일관성 검사: `labels` 테이블 중복 탐지 쿼리 + `relations` 순환 참조 CTE
- 지식 → AI 질의: 검색 → AI 질의와 동일한 컨텍스트 전달 인터페이스 재사용

### 7.6 AI 대화 UX 리뉴얼 (20-6)

- **SSE 스트리밍 아키텍처**: Reasoning Lab의 `stream_executor.py` → `reason-session.js` 패턴 재사용
  - BE: 20-1(R1)에서 분리 완료된 `stream_executor.py` 코어 + `rag_context_builder.py` 호출
  - FE: `ask-stream.js` 신규 — `EventSource` 또는 `fetch` + `ReadableStream` 패턴
- **세션 관리**: `/api/conversations` 기존 API 활용 + 세션 제목 자동 생성 (첫 질문 요약)
  - `ask-session.js` 신규 — `reason-session.js`(326줄) 패턴 참조
- **Chat UI 컴포넌트**: 메시지 버블 렌더링 → `ask-chat.js` 신규
  - `context_chunks[]` 배열 렌더링 (현재 API 응답에 존재, FE 미렌더링)
  - Markdown 렌더링: 기존 `marked.js` 재사용 (Reasoning Lab에서 사용 중)
- **모듈 분리 설계** (REFACTOR-3 사전 방지):
  - `ask.js` (현재 소규모) → `ask-chat.js` + `ask-session.js` + `ask-stream.js`
  - 각 모듈 300줄 이하 유지 목표

### 7.7 코그니티브 대시보드 (20-7)

- **FE 아키텍처**: `web/public/js/cognitive/` 디렉토리 신규 생성
  - `cognitive-dashboard.js` — 메인 컨트롤러 (탭/섹션 전환)
  - `cognitive-memory.js` — 메모리 뷰어 (장기/단기/작업 기억)
  - `cognitive-learning.js` — 학습 인사이트 카드
  - `cognitive-meta.js` — 메타인지 게이지
- **BE API 검증 필요 사항**:
  - 각 코그니티브 모듈 API의 응답 스키마 확인 (FE 렌더링에 필요한 필드 존재 여부)
  - `/api/memory`, `/api/learning` 등의 페이지네이션/필터 지원 여부
  - 데이터가 실제로 축적되어 있는지 확인 (빈 데이터 시 fallback UI 필요)
- **차트 라이브러리**: `/admin/statistics`에서 사용 중인 Chart.js 재사용
  - 메타인지 확신도 → Gauge/Doughnut 차트
  - 학습 트렌드 → Line 차트
  - 메모리 분포 → Bar 차트
- **HTML 페이지**: `web/src/pages/cognitive.html` 신규 + 라우터 등록 (`backend/routers/pages/user_pages.py`)
- **LNB**: `header-component.js`에 사용자 메뉴 항목 추가 (관리자 메뉴와 분리)

### 7.8 지식 그래프 인터랙티브 탐색 (20-8)

- **시맨틱 라벨**: `graph.py` API 응답에 `label_text`, `label_type`, `keywords[]` 필드 추가
  - DB 쿼리: `knowledge_chunks` JOIN `labels` JOIN `chunk_keywords`로 의미 있는 라벨 구성
  - 라벨 유형별 컬러 팔레트: D3 `scaleOrdinal(schemeCategory10)` 활용
- **인터랙션 레이어**: `knowledge-graph.js` 확장 또는 `graph-interactions.js` 분리
  - 노드 클릭: 사이드 패널에 청크 미리보기 (제목, 내용 앞 200자, 라벨, 관계)
  - 더블클릭: 연결된 노드 확장 (API `/api/knowledge/graph/expand?node_id=X`)
  - 호버: 연결 엣지 하이라이트 + 관계 타입 툴팁
- **필터 패널**: 20-3/20-4와 공통 필터 컴포넌트 재사용 가능성 검토
  - 프로젝트/라벨 필터: BE API 파라미터 `?project_id=&label_id=` 추가
  - 깊이(hop) 제어: API `?depth=1|2|3` 파라미터
  - 시간범위: API `?from_date=&to_date=` 파라미터
- **클러스터 시각화**: D3 force simulation `forceCluster` 커스텀 포스 또는 라벨 기반 그룹핑
  - 시각적 영역: `d3.voronoi` 또는 `ConvexHull` 오버레이
  - 난이도 높음 — 1단계에서는 컬러코딩까지만 구현, 영역 표시는 2단계로 유보 검토
- **모듈 분리 설계** (REFACTOR-3 사전 방지):
  - `knowledge-graph.js` → `graph-core.js` + `graph-filters.js` + `graph-interactions.js`
  - 각 모듈 300줄 이하 유지 목표

---

## 8. 향후 확장 (Phase 20 이후)

| 방향 | 관련 Phase | 단계 | 비고 |
|------|:----------:|:----:|------|
| 청크 관리 3단계: 전자동 + 도메인 특화 | 20-2 | 장기 | AI/ML 팀 필요, LLM Fine-tuning |
| 검색 품질 모드(정밀/균형/광범위) | 20-3 | 중기 | 프리셋 기반 |
| Boolean 쿼리 + 검색 캐시 | 20-3 | 중기 | |
| 대화 관리/내보내기/공유 | 20-4 | 중기 | |
| 민감 정보 자동 차단 정책 | 20-4 | 장기 | 보안 정책 설계 필요 |
| RBAC 역할 기반 접근 제어 | 20-5 | 장기 | 전체 시스템 영향 |
| 관계 타입 확장 | 20-5 | 장기 | 근거, 반례, 인용 등 |
| 변경 diff + 롤백(버전 관리) | 20-5 | 장기 | |
| 대화 폴더/태그 분류 + 공유 링크 | 20-6 | 중기 | 세션 관리 확장 |
| 음성 입력/TTS 출력 | 20-6 | 장기 | Web Speech API |
| 퍼스널리티 프로필 편집 UI | 20-7 | 중기 | 응답 톤·상세도·언어 선호 |
| 컨텍스트 맵 시각화 | 20-7 | 중기 | 문서 간 연결을 AI가 어떻게 이해하는지 |
| 메모리 수동 편집/삭제 | 20-7 | 중기 | 사용자가 AI 기억 관리 |
| 학습 리셋/편향 교정 | 20-7 | 장기 | 윤리적 검토 필요 |
| 커뮤니티 감지 알고리즘 (Louvain) | 20-8 | 중기 | 클러스터 자동 분류 |
| 시간축 애니메이션 (지식 성장 재생) | 20-8 | 장기 | D3 transition 활용 |
| 그래프 내보내기 (PNG/SVG/JSON) | 20-8 | 중기 | |
| 관계 타입별 엣지 스타일 분화 | 20-8 | 중기 | 20-5 관계 확장과 연계 |

---

## 9. 참조

- [Phase 19 Master Plan](../phases/phase-19-master-plan.md)
- [Phase 19 Chain](../phases/phase-chain-19.md) (completed)
- **[Phase 19 브라우저 테스트 결과](../phases/phase-19-browser-test.md)** — 미해결 이슈 5건 → 20-0 편성
- **[Phase 20 선행 분석 결과](260222-phase20-선행분석결과.md)** — 앱 규모·공백 식별·추천 3가지 도출
- [PAB 검색 통합/개선 보고서](260221-2330-pab-검색-통합-개선-보고서.md)
- [PAB AI 질의 통합/개선 보고서](260221-2330-pab-ai질의-통합-개선-보고서.md)
- [PAB 지식구조 통합/개선 보고서](260221-2330-pab-지식구조-통합-개선-보고서.md)
- [Phase 19 정밀분석](260221-phase19-정밀분석.md)
- [청크관리 통합 최적화 전략](260221-1802-청크관리-통합-최적화-전략-10대-전문가-분석.md)
- [리팩토링 레지스트리](../refactoring/refactoring-registry.md)
- [리팩토링 규정](../refactoring/refactoring-rules.md)

---

## 10. 구현 검증 지표 (선행 분석 기반)

개발 완료 후, 각 Sub-Phase가 선행 분석의 요구사항에 맞게 구현되었는지 검증하기 위한 지표.
**Task 생성 전/후 비교표**와 함께 사용하여 누락 없는 구현을 보장한다.

### 10.1 Sub-Phase별 구현 검증 체크리스트

#### 20-0: Phase 19 핫픽스 — [상세: §2.0](#20-phase-19-핫픽스-p0--phase-20-0)

| # | 검증 항목 | 선행 요구사항 | 검증 방법 | PASS 기준 |
|:-:|----------|-------------|----------|----------|
| V-0-1 | ISS-1 해소 | AI 키워드 추천 버튼 TypeError 수정 | 브라우저 E2E TC-1-2 | 그룹 상세 → AI 추천 클릭 → 결과 표시, 콘솔 에러 없음 |
| V-0-2 | ISS-7 해소 | 초기 탭 activate() 호출 | 브라우저 E2E TC-4-3 | `/admin/knowledge-workflow` 첫 로드 시 파일 목록 즉시 표시 |
| V-0-3 | ISS-4 해소 | LNB 구 메뉴 삭제 | 브라우저 E2E TC-4-9 | LNB에 "지식 워크플로우" 단일 메뉴만 표시 |
| V-0-4 | ISS-5/6 해소 | 반응형 grid 수정 | 브라우저 E2E TC-2-3, TC-2-4 | Tablet(1000px), Mobile(480px)에서 카드 오버플로우 없음 |
| V-0-5 | 회귀 방지 | 기존 테스트 유지 | `pytest tests/ -v` | 168 passed, 0 failed |
| V-0-6 | 전체 E2E | 23 TC 전체 통과 | 브라우저 E2E 전체 재실행 | 23 TC ALL PASS |

#### 20-1: 선행 리팩토링 — [상세: §2.1](#21-선행-리팩토링-p0--phase-20-1)

| # | 검증 항목 | 선행 요구사항 | 검증 방법 | PASS 기준 |
|:-:|----------|-------------|----------|----------|
| V-1-1 | R1 분리 완료 | `stream_executor.py` 588줄 → 3파일 | `wc -l` 각 파일 | 메인 ≤300, `rag_context_builder.py` ≤200, `stream_post_processor.py` ≤150 |
| V-1-2 | R2 분리 완료 | `statistics_service.py` 699줄 → 3파일 | `wc -l` 각 파일 | 메인 ≤250, `statistics_document.py` ≤200, `statistics_knowledge.py` ≤200 |
| V-1-3 | R3 분리 완료 | `labels_crud.py` 575줄 → 2파일 | `wc -l` 각 파일 | 메인 ≤350, `labels_validation.py` ≤250 |
| V-1-4 | R4 분리 완료 | `reason-control.js` 498줄 → 2파일 | `wc -l` 각 파일 | 메인 ≤300, `reason-rag-filter.js` ≤200 |
| V-1-5 | R5 분리 완료 | `reason_helpers.py` 484줄 → 2파일 | `wc -l` 각 파일 | 메인 ≤300, `reason_parsers.py` ≤200 |
| V-1-6 | 500줄 상한 | 모든 대상 파일 500줄 이하 | `wc -l` 전체 | 분리 후 각 파일 ≤500줄 |
| V-1-7 | 동작 무변경 | 기능 변경 없이 구조만 분리 | `pytest tests/ -v` | 168 passed, 0 failed |
| V-1-8 | 레지스트리 갱신 | 리팩토링 레지스트리 이력 기록 | 파일 확인 | 해소 이력 + 날짜 + 분리안 기록됨 |

#### 20-2: 청크 관리 2단계 — [상세: §2.2](#22-청크-관리-2단계-p1--phase-20-2)

| # | 검증 항목 | 선행 요구사항 | 검증 방법 | PASS 기준 |
|:-:|----------|-------------|----------|----------|
| V-2-1 | Stepper UI | 탭 → Stepper 전환 | 브라우저 확인 | 1→2→3 순차 진행 표시, 단계 이동 제어 |
| V-2-2 | 빠른 생성+승인 | 파일 드롭 → AI → 라벨 → 승인 | 워크플로우 실행 | 파일 업로드 후 자동 라벨 + 승인 완료 |
| V-2-3 | 자동 승인 규칙 | 신뢰도 기반 자동/수동 분기 | API + 관리자 설정 | 임계값 초과 시 자동 승인, 미만 시 수동 대기 |
| V-2-4 | Bulk API | 일괄 승인/라벨 BE 처리 | API 테스트 | 다중 청크 일괄 처리 성공, 개별 루프 대비 성능 향상 |
| V-2-5 | 모듈 분리 | `knowledge-workflow.js` 500줄 초과 방지 | `wc -l` | 각 모듈 ≤400줄 |

#### 20-3: 검색 고도화 — [상세: §2.3](#23-검색-고도화-p1--phase-20-3)

| # | 검증 항목 | 선행 요구사항 | 검증 방법 | PASS 기준 |
|:-:|----------|-------------|----------|----------|
| V-3-1 | 고급 필터 | 라벨/프로젝트/승인상태/날짜 결합 | 브라우저 확인 | 필터 조합 시 결과 정상 반환 |
| V-3-2 | 결과 근거 | 매칭 타입 + 스코어 표시 | 검색 결과 UI | 각 결과에 키워드/벡터/하이브리드 표시 |
| V-3-3 | GIN 인덱스 | 키워드 검색 성능 향상 | DB 쿼리 EXPLAIN | GIN 인덱스 사용 확인, 응답 시간 감소 |
| V-3-4 | 검색→AI 연계 | 선택 결과 → AI 질의 컨텍스트 | 워크플로우 실행 | 검색 결과 선택 → AI 질의 페이지에 컨텍스트 전달 |

#### 20-4: AI 질의 고도화 — [상세: §2.4](#24-ai-질의-고도화-p1--phase-20-4)

| # | 검증 항목 | 선행 요구사항 | 검증 방법 | PASS 기준 |
|:-:|----------|-------------|----------|----------|
| V-4-1 | 출처 표시 | 참조 청크 링크 + 관련도 | AI 답변 UI | 답변 하단에 참조 청크 목록 표시 |
| V-4-2 | RAG 필터 | 라벨/프로젝트/승인상태 범위 제한 | 필터 UI + API | 필터 적용 시 RAG 결과 범위 제한 확인 |
| V-4-3 | 컨텍스트 미리보기 | RAG 결과 질의 전 확인/편집 | 브라우저 확인 | 질의 전 RAG 청크 목록 표시, 제거 가능 |
| V-4-4 | 검색→질의 전달 | 검색 선택 청크 → 컨텍스트 주입 | 워크플로우 실행 | 검색에서 전달된 청크가 RAG 컨텍스트에 포함 |

#### 20-5: 지식구조 고도화 — [상세: §2.5](#25-지식구조-고도화-p2--phase-20-5)

| # | 검증 항목 | 선행 요구사항 | 검증 방법 | PASS 기준 |
|:-:|----------|-------------|----------|----------|
| V-5-1 | 이력 타임라인 | 청크별 이력 뷰 | 브라우저 확인 | 생성→승인→라벨 변경 시간순 표시 |
| V-5-2 | 라벨 일관성 | 중복 라벨 탐지 | API 테스트 | 중복 생성 시도 시 경고/차단 |
| V-5-3 | 순환 관계 방지 | 순환 참조 CTE | API 테스트 | A→B→C→A 순환 생성 시 차단 |
| V-5-4 | 지식→AI 연계 | 선택 청크 → AI 질의 | 워크플로우 실행 | 청크 선택 → AI 질의 컨텍스트 전달 |

#### 20-6: AI 대화 UX 리뉴얼 — [상세: §2.6](#26-ai-대화-ux-리뉴얼-p2--phase-20-6)

| # | 검증 항목 | 선행 요구사항 (선행 분석 §4.1) | 검증 방법 | PASS 기준 |
|:-:|----------|-------------------------------|----------|----------|
| V-6-1 | 채팅 버블 UI | 사용자/AI 메시지 시각 분리 | 브라우저 스크린샷 | 사용자(우측) / AI(좌측) 버블 분리, 타임스탬프·아바타 표시 |
| V-6-2 | SSE 스트리밍 | 토큰 단위 실시간 표시 | 브라우저 + Network 탭 | EventSource 연결 성공, 토큰 순차 렌더링, 완료 후 전체 표시 |
| V-6-3 | 대화 세션 관리 | 세션 목록 사이드바 + 새 대화/이어가기 | 브라우저 확인 | 사이드바에 세션 목록, 새 대화 버튼, 세션 클릭 시 이전 대화 로드 |
| V-6-4 | 세션 제목 자동 생성 | 첫 질문 기반 제목 | API 응답 확인 | 첫 질문 후 세션 목록에 의미 있는 제목 자동 표시 |
| V-6-5 | 답변별 액션 | 복사/Markdown/출처/피드백 | 브라우저 확인 | 각 답변에 액션 버튼 표시, 클릭 시 동작 |
| V-6-6 | 출처 펼치기 | `context_chunks[]` 렌더링 | 브라우저 확인 | "출처" 버튼 클릭 → 참조 청크 목록 펼침 |
| V-6-7 | 대화 내보내기 | Markdown/JSON 다운로드 | 다운로드 확인 | 세션 단위 파일 다운로드 성공, 내용 정상 |
| V-6-8 | 모듈 분리 | REFACTOR-3 사전 방지 | `wc -l` | `ask-chat.js`, `ask-session.js`, `ask-stream.js` 각 ≤300줄 |

#### 20-7: 코그니티브 대시보드 — [상세: §2.7](#27-코그니티브-대시보드-p2--phase-20-7)

| # | 검증 항목 | 선행 요구사항 (선행 분석 §4.2) | 검증 방법 | PASS 기준 |
|:-:|----------|-------------------------------|----------|----------|
| V-7-1 | 대시보드 페이지 | `/cognitive` 신규 페이지 | 브라우저 접속 | 페이지 로드 성공, 5개 모듈 섹션 표시 |
| V-7-2 | 메모리 뷰어 | 장기/단기/작업 기억 목록 + 검색 | 브라우저 확인 | `/api/memory` 데이터 표시, 검색 동작, 시간순 타임라인 |
| V-7-3 | 학습 인사이트 | 최근 관심사, 자주 질문 주제 | 브라우저 확인 | `/api/learning` 데이터 카드형 시각화 |
| V-7-4 | 메타인지 지표 | 확신도/불확실도 게이지 | 브라우저 확인 | Chart.js 게이지 차트, 최근 답변 트렌드 표시 |
| V-7-5 | LNB 메뉴 | 사용자 메뉴에 "AI Brain" 추가 | 브라우저 확인 | LNB에 메뉴 표시, 클릭 시 `/cognitive` 이동 |
| V-7-6 | BE API 연동 | 5개 모듈 API 정상 호출 | Network 탭 | 모든 API 200 응답, 에러 없음 |
| V-7-7 | 빈 데이터 처리 | 데이터 없을 때 fallback UI | 브라우저 확인 | 빈 상태 안내 메시지 표시 (에러 아님) |

#### 20-8: 지식 그래프 인터랙티브 탐색 — [상세: §2.8](#28-지식-그래프-인터랙티브-탐색-p2--phase-20-8)

| # | 검증 항목 | 선행 요구사항 (선행 분석 §4.3) | 검증 방법 | PASS 기준 |
|:-:|----------|-------------------------------|----------|----------|
| V-8-1 | 시맨틱 라벨 | 청크 제목/키워드 기반 라벨 | 브라우저 확인 | "Chunk #56" → 의미 있는 텍스트 라벨 표시 |
| V-8-2 | 컬러코딩 | 라벨 유형별 색상 분류 | 브라우저 확인 | 노드 색상이 라벨 유형에 따라 구분됨 |
| V-8-3 | 클릭→미리보기 | 노드 클릭 시 사이드 패널 | 브라우저 확인 | 청크 제목, 내용 앞 200자, 라벨, 관계 표시 |
| V-8-4 | 관계 확장 | 더블클릭 → 연결 노드 확장 | 브라우저 확인 | 더블클릭 시 연결된 노드 추가 로드 |
| V-8-5 | 호버 하이라이트 | 호버 시 연결 엣지 강조 | 브라우저 확인 | 호버한 노드의 엣지가 시각적으로 강조 |
| V-8-6 | 필터 패널 | 프로젝트/라벨/관계타입/시간/깊이 | 브라우저 확인 | 필터 조합 시 그래프 정상 갱신 |
| V-8-7 | 그래프→AI 연계 | 선택 노드 → AI 질의 컨텍스트 | 워크플로우 실행 | 노드 선택 → AI 질의 페이지에 컨텍스트 전달 |
| V-8-8 | 모듈 분리 | REFACTOR-3 사전 방지 | `wc -l` | `graph-core.js`, `graph-filters.js`, `graph-interactions.js` 각 ≤300줄 |

---

### 10.2 Task 생성 전/후 비교 체크리스트

Phase 별 Master Plan → Task 생성 시, 아래 항목을 **전/후 비교**하여 누락 방지:

| 비교 항목 | 전 (작업목록 기준) | 후 (Task 생성 후) | 확인자 |
|----------|:-----------------:|:-----------------:|:------:|
| Task 수 | §2.X "예상 Task 수" | 실제 생성된 Task 수 | Team Lead |
| 도메인 커버 | §2.X 기능 테이블 도메인 열 | Task별 도메인 태그 | Team Lead |
| 검증 항목 매핑 | §10.1 V-X-Y 체크리스트 | 각 Task의 완료 기준에 V-X-Y 매핑 | Verifier |
| 리팩토링 반영 | §3 리팩토링 대상 | Task에 REFACTOR-3 사전 방지 포함 여부 | Team Lead |
| 교차 의존 처리 | §4 교차 의존 | Task 간 blocks/blockedBy 설정 | Team Lead |
| 기술 검토 반영 | §7.X 기술 검토 | Task 명세에 기술 결정 반영 | Team Lead |

### 10.3 전체 완료 기준 (Phase 20 종합)

| 지표 | 목표값 | 측정 방법 |
|------|:------:|----------|
| 단위 테스트 | 168+ passed, 0 failed | `pytest tests/ -v` |
| 브라우저 E2E | 23+ TC ALL PASS | 브라우저 테스트 전체 재실행 |
| 코드 품질 | 모든 파일 ≤500줄 | `wc -l` 전체 스캔 |
| 레지스트리 | 700줄 초과 파일 0건 | 리팩토링 레지스트리 확인 |
| 검증 체크리스트 | V-0-1 ~ V-8-8 전체 PASS | §10.1 체크리스트 재실행 |
| 선행 분석 공백 해소 | 6개 공백 중 4개+ 해소 | [선행 분석 §3](260222-phase20-선행분석결과.md#3-분석에서-발견된-주요-공백) 대조 |
