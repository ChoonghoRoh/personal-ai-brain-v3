# 🧠 Reasoning Lab 사용 매뉴얼

## 개요

Reasoning Lab은 저장된 지식을 기반으로 추론(Reasoning)을 수행하는 도구입니다. 프로젝트나 라벨을 기반으로 관련 지식을 수집하고, 관계 그래프를 추적하여 질문에 대한 답변을 생성합니다.

**접속 경로**: `/reason`

---

## 주요 기능

### 1. Reasoning 모드

Reasoning Lab은 4가지 모드를 제공합니다:

#### 1.1 📐 설계/배경 설명 (Design Explain)

**용도**: 설계 의도와 배경을 명확히 설명합니다.

**언제 사용하나요?**
- 왜 이렇게 설계했는지 파악할 때
- 어떤 맥락에서 결정했는지 이해할 때
- 설계 문서의 배경을 파악할 때

**예시 질문**:
- "이 아키텍처는 왜 이렇게 설계되었나요?"
- "이 결정의 배경은 무엇인가요?"

#### 1.2 ⚠️ 리스크 분석 (Risk Review)

**용도**: 잠재적 리스크와 문제점을 식별합니다.

**언제 사용하나요?**
- 프로젝트의 위험 요소를 찾을 때
- 관계 그래프를 통해 영향도를 추적할 때
- 잠재적 문제점을 발견할 때

**예시 질문**:
- "이 변경사항의 리스크는 무엇인가요?"
- "이 부분에서 발생할 수 있는 문제는?"

#### 1.3 🚀 다음 단계 제안 (Next Steps)

**용도**: 현재 상태를 기반으로 논리적인 다음 단계를 제안합니다.

**언제 사용하나요?**
- 프로젝트 진행 방향을 찾을 때
- 개선 사항을 찾을 때
- 다음에 무엇을 해야 할지 모를 때

**예시 질문**:
- "다음에 뭐하면 좋을까요?"
- "이 프로젝트의 다음 단계는?"

#### 1.4 📜 히스토리/맥락 추적 (History Trace)

**용도**: 지식의 진화와 맥락을 시간적/논리적 순서로 추적합니다.

**언제 사용하나요?**
- 의사결정 과정을 이해할 때
- 변화 흐름을 추적할 때
- 맥락의 연속성을 파악할 때

**예시 질문**:
- "이 결정은 어떻게 내려졌나요?"
- "이 프로젝트의 변화 과정은?"

---

### 2. 입력 필드

#### 2.1 프로젝트 ID

**형식**: 쉼표로 구분된 숫자 (예: `1, 3, 5`)

**용도**: 특정 프로젝트의 지식만 사용하여 Reasoning을 수행합니다.

**사용 방법**:
- 프로젝트 ID를 쉼표로 구분하여 입력합니다
- 빈 값이면 모든 프로젝트를 대상으로 합니다

**예시**:
```
1, 3
```

#### 2.2 라벨 이름

**형식**: 쉼표로 구분된 라벨 이름 (예: `ai, architecture`)

**용도**: 특정 라벨이 부여된 청크만 사용하여 Reasoning을 수행합니다.

**사용 방법**:
- 라벨 이름을 쉼표로 구분하여 입력합니다
- 빈 값이면 모든 라벨을 대상으로 합니다

**예시**:
```
ai, backend, high
```

#### 2.3 질문 또는 지시사항

**용도**: Reasoning의 목적과 방향을 명확히 합니다.

**작성 팁**:
- 구체적이고 명확한 질문을 작성하세요
- 모드에 맞는 질문을 작성하세요
- 필요한 맥락을 포함하세요

**예시**:
- "다음에 뭐하면 좋을까?"
- "이 아키텍처의 리스크는 무엇인가요?"
- "이 프로젝트의 설계 배경을 설명해주세요."

---

### 3. 결과 표시

Reasoning 실행 후 다음 정보가 표시됩니다:

#### 3.1 결과 요약 (Result Summary)

**표시 정보**:
- **참고 문서 수**: Reasoning에 사용된 고유 문서의 개수
- **사용된 지식 청크**: Reasoning에 사용된 청크의 개수
- **발견된 관계**: 청크 간에 발견된 관계의 개수

#### 3.2 최종 결론 (Final Answer)

Reasoning의 최종 답변이 표시됩니다.

**형식**:
- 구조화된 텍스트
- 단락 구분
- 주요 포인트 강조

#### 3.3 사용된 컨텍스트 (Context)

Reasoning에 사용된 지식 정보를 확인할 수 있습니다.

**탭 구성**:
- **청크 목록**: 사용된 모든 청크의 내용
- **문서 목록**: 사용된 문서 목록 및 문서 열기 링크

**청크 정보**:
- 프로젝트 이름
- 문서 이름
- 청크 ID
- 청크 내용

**문서 정보**:
- 문서 이름
- 프로젝트 이름
- 사용된 청크 개수
- "문서 열기" 버튼 (새 탭에서 열림)

#### 3.4 Reasoning 단계 (Reasoning Steps)

Reasoning이 수행된 단계별 로그가 표시됩니다.

**표시 형식**:
- 번호가 매겨진 목록
- 각 단계의 설명

---

## 사용 시나리오

### 시나리오 1: 프로젝트 다음 단계 제안

1. **모드 선택**: "🚀 다음 단계 제안 (Next Steps)" 선택
2. **프로젝트 ID 입력**: `1` (현재 프로젝트)
3. **질문 입력**: "다음에 뭐하면 좋을까?"
4. **Reasoning 실행** 버튼 클릭
5. 결과에서 다음 단계 제안 확인

### 시나리오 2: 특정 라벨의 리스크 분석

1. **모드 선택**: "⚠️ 리스크 분석 (Risk Review)" 선택
2. **라벨 이름 입력**: `backend, high` (백엔드 관련 중요 항목)
3. **질문 입력**: "이 부분의 잠재적 리스크는?"
4. **Reasoning 실행** 버튼 클릭
5. 결과에서 리스크 항목 확인

### 시나리오 3: Knowledge Studio에서 Reasoning 시작

1. Knowledge Studio (`/knowledge`)에서 관심 있는 청크를 선택
2. "🧠 이 청크로 Reasoning 시작" 버튼 클릭
3. Reasoning Lab으로 이동하며 질문 필드에 청크 내용이 자동 입력됨
4. 모드를 선택하고 Reasoning 실행

---

## URL 파라미터

### seed_chunk

특정 청크를 시드(seed)로 사용하여 Reasoning을 시작할 수 있습니다.

**형식**: `?seed_chunk={chunk_id}`

**예시**:
```
/reason?seed_chunk=5
```

**동작**:
- 해당 청크의 내용이 질문 필드에 자동으로 입력됩니다
- 해당 청크와 관련된 지식이 우선적으로 사용됩니다

---

## API 엔드포인트

Reasoning Lab은 다음 API를 사용합니다:

### POST /api/reason

Reasoning을 실행합니다.

**요청 본문**:
```json
{
  "mode": "design_explain|risk_review|next_steps|history_trace",
  "inputs": {
    "projects": [1, 3],
    "labels": ["ai", "architecture"]
  },
  "question": "질문 또는 지시사항"
}
```

**응답 구조**:
```json
{
  "answer": "최종 답변",
  "context_chunks": [
    {
      "id": 1,
      "content": "청크 내용",
      "document": "문서 이름",
      "project": "프로젝트 이름"
    }
  ],
  "relations": [
    {
      "id": 1,
      "relation_type": "cause-of",
      "source_chunk_id": 1,
      "target_chunk_id": 2
    }
  ],
  "reasoning_steps": [
    "단계 1 설명",
    "단계 2 설명"
  ]
}
```

---

## 팁

1. **모드 선택**: 질문의 목적에 맞는 모드를 선택하면 더 정확한 답변을 얻을 수 있습니다

2. **프로젝트/라벨 필터링**: 특정 프로젝트나 라벨로 필터링하면 더 집중된 답변을 얻을 수 있습니다

3. **질문 작성**: 구체적이고 명확한 질문을 작성하면 더 유용한 답변을 얻을 수 있습니다

4. **컨텍스트 확인**: 결과의 "사용된 컨텍스트"를 확인하여 Reasoning이 어떤 지식을 사용했는지 파악할 수 있습니다

5. **문서 열기**: 문서 목록에서 "문서 열기" 버튼을 클릭하여 원본 문서를 확인할 수 있습니다

6. **단계 로그**: Reasoning 단계를 확인하여 추론 과정을 이해할 수 있습니다

---

## 문제 해결

### Reasoning 실행이 실패할 때

- **네트워크 오류**: 인터넷 연결을 확인하세요
- **서버 오류**: 서버가 실행 중인지 확인하세요
- **입력 오류**: 필수 항목(모드)이 선택되었는지 확인하세요
- **빈 결과**: 프로젝트 ID나 라벨로 필터링한 경우 해당하는 지식이 없을 수 있습니다

### 결과가 만족스럽지 않을 때

- **모드 변경**: 다른 모드를 시도해보세요
- **질문 수정**: 더 구체적이고 명확한 질문으로 수정해보세요
- **필터 조정**: 프로젝트 ID나 라벨 필터를 조정해보세요
- **컨텍스트 확인**: 사용된 컨텍스트를 확인하여 필요한 지식이 포함되었는지 확인하세요

### 로딩이 오래 걸릴 때

- Reasoning은 복잡한 작업이므로 시간이 걸릴 수 있습니다
- 대량의 지식을 처리할 때는 더 오래 걸릴 수 있습니다
- 브라우저를 새로고침하지 마세요

### 결과가 표시되지 않을 때

- 브라우저 콘솔에서 오류 메시지를 확인하세요
- 페이지를 새로고침하고 다시 시도해보세요
- 서버 로그를 확인하세요

---

## 제한사항

- Reasoning은 저장된 지식에 기반하므로, 관련 지식이 없으면 답변을 생성하기 어려울 수 있습니다
- 대량의 지식을 처리할 때는 시간이 오래 걸릴 수 있습니다
- 결과의 정확도는 저장된 지식의 품질에 의존합니다

---

## 고급 사용법

### 여러 프로젝트 동시 분석

프로젝트 ID에 여러 값을 입력하여 여러 프로젝트의 지식을 통합 분석할 수 있습니다.

**예시**:
```
프로젝트 ID: 1, 3, 5
```

### 라벨 조합 활용

여러 라벨을 조합하여 특정 관점의 지식만 사용할 수 있습니다.

**예시**:
```
라벨 이름: ai, high, backend
```

이렇게 하면 AI 관련이면서 중요도가 높고 백엔드와 관련된 지식만 사용됩니다.

### 시드 청크 활용

Knowledge Studio에서 청크를 선택하여 Reasoning을 시작하면, 해당 청크와 관련된 지식이 우선적으로 사용됩니다.

---

## 관련 기능

- **Knowledge Studio** (`/knowledge`): 지식 구조 탐색 및 청크 선택
- **Knowledge Admin** (`/knowledge-admin`): 라벨 관리 및 청크 라벨 관리
- **문서 뷰어** (`/document/{path}`): 원본 문서 확인

