# Task 16-1-3: [BE] DB 트랜잭션 분할

**우선순위**: 16-1 내 3순위
**예상 작업량**: 중간
**의존성**: 16-1-1 이후 권장 (동일 서비스 파일)
**담당 팀원**: backend-dev
**상태**: 대기

---

## §1. 개요

`execute_workflow`(run-full 진입점) 내 6단계 전체를 하나의 DB 세션으로 처리하는 구조를 단계별 세션 분리·커밋으로 변경하여, 중간 단계 실패 시 이전 단계 결과가 보존되도록 한다.

참조: [리스크 분석 §3.2 방안 H](../../../planning/260217-1600-AI자동화기능-리스크분석.md)

## §2. 파일 변경 계획

| 구분 | 파일 | 변경 내용 |
|------|------|----------|
| 수정 | `backend/services/automation/ai_workflow_service.py` | 단계별 SessionLocal() 컨텍스트 분리 |

## §3. 작업 체크리스트 (Done Definition)

- [ ] 텍스트 추출 → commit; 청크 생성 → commit; 키워드 추출 → commit; ... 단계별 세션 분리
- [ ] 각 단계 시작 시 새 SessionLocal() 컨텍스트 진입
- [ ] 중간 실패 시 해당 단계만 롤백, 이전 단계 커밋 유지
- [ ] 기존 6단계 동작 결과와 일치 (정상 완료 시 최종 상태 동일)
- [ ] 기존 자동화 테스트 통과

## §4. 참조

- [Phase 16 Master Plan §4.2 — 16-1-3](../../phase-16-master-plan.md)
