# Phase 16-1 Plan — AI 자동화 즉시 적용

**Phase**: 16-1
**목표**: AI 자동화 파이프라인의 안정성·UX를 기능 동작 변경 없이 즉시 개선
**선행**: Phase 15-2 (AI 자동화 run-full·SSE) 완료
**기준 문서**: [AI 자동화 리스크 분석 §3.1](../../planning/260217-1600-AI자동화기능-리스크분석.md)

---

## 1. 배경

Phase 15-2에서 구현된 AI 자동화 6단계 파이프라인(run-full)이 80개 이상 파일 처리 시 다음 리스크를 가진다:
- 진행률이 단계(step) 단위만 표시 → 사용자가 멈춘 것으로 오해
- 대량 파일 선택 시 사전 경고 없음 → 예상 소요 시간 불투명
- 전체 워크플로우가 단일 DB 세션 → 중간 실패 시 전체 롤백
- SSE 연결이 장시간 시 타임아웃 → 진행률 끊김

## 2. 범위

| Task | 도메인 | 내용 | 담당 |
|------|--------|------|------|
| 16-1-1 | [BE] | 단계별 세부 진행률·청크 카운터·ETA SSE 이벤트 | backend-dev |
| 16-1-2 | [FE] | 파일 선택 시 사전 검증 UI (선택 수·예상 청크·경고) | frontend-dev |
| 16-1-3 | [BE] | DB 트랜잭션 분할 (단계별 Session 분리·커밋) | backend-dev |
| 16-1-4 | [FS] | SSE Heartbeat·재연결 (BE heartbeat + FE reconnect) | backend-dev + frontend-dev |

## 3. 완료 기준

- [ ] SSE `progress` 이벤트에 `detail.current/total`, `eta_seconds` 포함
- [ ] 파일 선택 시 "선택: N개 | 예상 청크: ~M | 예상 소요: ~K분" UI 표시
- [ ] 50개 초과 선택 시 경고 스타일 적용
- [ ] 단계 경계마다 DB 세션 분리·커밋 (중간 실패 시 이전 단계 유지)
- [ ] SSE heartbeat 수신, 30초 미수신 시 자동 재연결
- [ ] 기존 자동화 테스트·6단계 동작 결과 호환 유지

## 4. 의존성

- 16-1-1과 16-1-2는 병렬 가능
- 16-1-3·16-1-4는 16-1-1과 동일 서비스 파일(`ai_workflow_service.py`) → 순서 조율 필요
- 권장 순서: 16-1-1 → 16-1-3 → 16-1-4(BE) → 16-1-2·16-1-4(FE) 병렬

## 5. 리스크

| 리스크 | 대응 |
|--------|------|
| ai_workflow_service.py 동시 수정 충돌 | 16-1-1 → 16-1-3 → 16-1-4 순차 진행 |
| SSE 재연결 시 기존 task_id 만료 | task_id 기반 progress 재구독 API 확인 |
| 기존 테스트 회귀 | 각 Task 완료 후 pytest 실행 |
