# Phase 16-2 Plan — AI 자동화 성능 개선

**Phase**: 16-2
**목표**: 80파일 처리 시 총 소요 100분+ → 약 15분으로 단축. 메모리 피크·DB 커넥션 개선.
**선행**: Phase 16-1 완료 (안정성·UX 즉시 개선)
**기준 문서**: [AI 자동화 리스크 분석 §3.2](../../planning/260217-1600-AI자동화기능-리스크분석.md)

---

## 1. 배경

Phase 16-1에서 진행률/DB분할/SSE 안정성을 확보했으나, 80개 파일 처리 시 여전히 100분 이상 소요된다:
- Qdrant 임베딩: 단건 호출 → 960회 API 호출 (병목)
- LLM 키워드 추출: 청크당 1회 호출 → 960회 LLM 호출 (최대 병목)
- 라벨 매칭: 모든 청크 x 모든 라벨 브루트포스 O(N*M)
- 메모리: 전체 문서를 한 번에 처리 → 메모리 피크

## 2. 범위

| Task | 도메인 | 내용 | 담당 |
|------|--------|------|------|
| 16-2-4 | [BE] | 라벨 매칭 역인덱스 (keyword→[label_id], O(N*K)) | backend-dev |
| 16-2-1 | [BE] | Qdrant 배치 임베딩 (50건 단위 batch upsert) | backend-dev |
| 16-2-2 | [BE] | LLM 키워드 추출 묶음 호출 (5~10청크/1회) | backend-dev |
| 16-2-3 | [BE] | 자동 배치 분할 실행 (20문서/배치, GC) | backend-dev |

## 3. 실행 순서

16-2-4 → 16-2-1 → 16-2-2 → 16-2-3 (마스터 플랜 권장 순서)
- 16-2-4: _match_labels() 수정 (독립)
- 16-2-1: _embed_chunks() 수정 (독립)
- 16-2-2: _extract_keywords() 수정 (독립)
- 16-2-3: execute_workflow() 상위에서 배치 분할 (16-2-1·2 통합 후)

## 4. 완료 기준

- [ ] 960청크 시 Qdrant 호출 약 20회 이하
- [ ] 960청크 시 LLM 호출 약 96~192회
- [ ] 라벨 매칭 O(N*M) → O(N*K) 개선
- [ ] 80문서 선택 시 4배치(20문서) 순차 처리, 배치 간 GC
- [ ] 기존 자동화 테스트 호환 유지
