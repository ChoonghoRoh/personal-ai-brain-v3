# Task 16-2-3: [BE] 자동 배치 분할 실행

**우선순위**: 16-2 내 4순위 (실행 순서)
**예상 작업량**: 높음
**의존성**: 16-2-1, 16-2-2 완료 후
**담당 팀원**: backend-dev
**상태**: 대기

---

## §1. 개요

80개 이상 문서를 한 번에 처리하면 메모리 피크와 장시간 단일 트랜잭션 문제가 발생한다. document_ids를 20개 단위 배치로 분할하여 순차 처리하고, 배치 간 GC를 수행한다.

참조: [리스크 분석 §3.3 방안 I](../../../planning/260217-1600-AI자동화기능-리스크분석.md)

## §2. 파일 변경 계획

| 구분 | 파일 | 변경 내용 |
|------|------|----------|
| 수정 | `backend/services/automation/ai_workflow_service.py` | `execute_workflow()` 배치 분할 로직 |

## §3. 작업 체크리스트 (Done Definition)

- [ ] document_ids를 20개 단위 배치로 분할
- [ ] 배치마다 6단계(텍스트→청크→키워드→라벨→승인→임베딩) 전체 실행
- [ ] 배치 간 gc.collect() 호출
- [ ] 진행률: 배치 1/4 → 0~25%, 2/4 → 25~50% 비율 배분
- [ ] 단일 task_id로 상위 진행률 노출
- [ ] 80문서 시 4배치 순차 처리
- [ ] 중간 배치 실패 시 이전 배치 결과 DB 유지

## §4. 참조

- [Phase 16 Master Plan §5.2 — 16-2-3](../../phase-16-master-plan.md)
