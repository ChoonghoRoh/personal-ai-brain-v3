# Task 19-4-1: 통합 페이지 스캐폴딩

> **도메인**: [FS]
> **담당**: backend-dev (BE 라우트) + frontend-dev (HTML/JS/CSS)
> **의존성**: 없음 (첫 Task)
> **예상 줄 수**: HTML ~120, JS ~200, CSS ~300

---

## 1. 목표

`/admin/knowledge-workflow` 라우트를 등록하고, 탭 기반 레이아웃 HTML + `KnowledgeWorkflow` 상태 관리 클래스 + 공통 CSS를 생성한다.

---

## 2. 구현 단계

### 2.1 BE: 라우트 등록

**파일**: `backend/main.py`

`_HTML_ROUTES` 배열에 추가:
```python
("/admin/knowledge-workflow", "admin/knowledge-workflow.html", "지식 워크플로우"),
```

기존 3개 라우트는 **Task 19-4-5에서 리다이렉트로 교체**. 이 Task에서는 신규 라우트만 추가.

### 2.2 FE: HTML 생성

**파일**: `web/src/pages/admin/knowledge-workflow.html` (신규)

구조:
```html
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="/static/favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="/static/css/admin/admin-styles.css" />
  <link rel="stylesheet" href="/static/css/admin/admin-knowledge-workflow.css" />
  <!-- 기존 CSS도 일부 재사용 (각 탭별 세부 스타일) -->
  <link rel="stylesheet" href="/static/css/admin/admin-chunk-create.css" />
  <link rel="stylesheet" href="/static/css/admin/admin-approval.css" />
  <link rel="stylesheet" href="/static/css/admin/admin-chunk-labels.css" />
  <title>Personal AI Brain - 지식 워크플로우</title>
</head>
<body>
  <div class="container">
    <div id="header-placeholder"></div>
    <div id="error-message" class="error" style="display: none"></div>
    <div id="success-message" class="success" style="display: none"></div>

    <div class="admin-container kw-container">
      <div class="admin-panel">
        <!-- 탭 바 -->
        <nav class="kw-tabs" role="tablist">
          <button class="kw-tab active" data-tab="create" role="tab">1. 생성</button>
          <button class="kw-tab" data-tab="approval" role="tab">2. 승인</button>
          <button class="kw-tab" data-tab="manage" role="tab">3. 관리</button>
        </nav>

        <!-- 탭 콘텐츠 -->
        <div class="kw-tab-content">
          <div id="tab-create" class="kw-tab-panel active" data-tab="create">
            <!-- Task 19-4-2에서 채움 -->
          </div>
          <div id="tab-approval" class="kw-tab-panel" data-tab="approval" style="display:none">
            <!-- Task 19-4-3에서 채움 -->
          </div>
          <div id="tab-manage" class="kw-tab-panel" data-tab="manage" style="display:none">
            <!-- Task 19-4-4에서 채움 -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 공통 스크립트 -->
  <script src="/static/js/components/layout-component.js"></script>
  <script src="/static/js/components/header-component.js"></script>
  <script src="/static/js/admin/admin-common.js"></script>
  <script src="/static/js/components/utils.js"></script>
  <script src="/static/js/components/pagination-component.js"></script>
  <!-- 기존 API + 클래스 재사용 -->
  <script src="/static/js/admin/chunk-approval-api.js"></script>
  <script src="/static/js/admin/chunk-approval-manager.js"></script>
  <script src="/static/js/admin/label-manager-api.js"></script>
  <script src="/static/js/admin/label-manager.js"></script>
  <!-- 신규 -->
  <script src="/static/js/admin/kw-tab-create.js"></script>
  <script src="/static/js/admin/kw-tab-approval.js"></script>
  <script src="/static/js/admin/kw-tab-manage.js"></script>
  <script src="/static/js/admin/knowledge-workflow.js"></script>
</body>
</html>
```

### 2.3 FE: KnowledgeWorkflow 상태 클래스

**파일**: `web/public/js/admin/knowledge-workflow.js` (신규, ~200줄)

핵심 메서드:
- `constructor()`: 탭 초기 상태, URL 파싱, 이벤트 바인딩
- `switchTab(tabName)`: 탭 패널 전환, URL 쿼리 업데이트, `history.pushState`
- `syncFromUrl()`: `?tab=` 파라미터 읽기 -> 해당 탭 활성화
- `handlePopState(event)`: 브라우저 뒤로가기 핸들링
- `notifyTabChange(fromTab, event)`: 탭 간 이벤트 전달 (예: 생성 완료 -> 승인 탭 리프레시)
- `registerTab(name, instance)`: 각 탭 모듈 등록

탭 인터페이스 규약:
```javascript
// 각 탭 모듈이 구현할 인터페이스
{
  init(container, workflow)   // 최초 1회 초기화
  activate()                  // 탭 활성화 시 호출
  deactivate()                // 탭 비활성화 시 호출
  refresh()                   // 데이터 리프레시
  onTabEvent(fromTab, event)  // 다른 탭에서 이벤트 수신
}
```

`DOMContentLoaded`에서:
1. `initializeAdminPage()` 호출
2. `KnowledgeWorkflow` 인스턴스 생성
3. 각 탭 모듈 인스턴스 생성 + `registerTab()` 호출
4. `syncFromUrl()` 호출 -> 초기 탭 활성화

### 2.4 FE: 통합 CSS

**파일**: `web/public/css/admin/admin-knowledge-workflow.css` (신규, ~300줄)

스타일 범위:
- `.kw-container`: 컨테이너 전체 폭
- `.kw-tabs`: 탭 바 (flex, gap 0, border-bottom)
- `.kw-tab`: 개별 탭 버튼 (active 상태 포함)
- `.kw-tab-content`: 탭 콘텐츠 래퍼
- `.kw-tab-panel`: 개별 탭 패널 (display 토글)
- `.kw-bulk-toolbar`: 다중 선택 시 툴바 (19-4-3, 19-4-4에서 사용)
- `.kw-checkbox-col`: 체크박스 열 (19-4-3, 19-4-4에서 사용)

기존 CSS 파일도 함께 로드하여 각 탭 내부 스타일은 기존 것을 최대한 재활용한다.

---

## 3. 수정/생성 파일 목록

| 구분 | 파일 | 작업 |
|------|------|------|
| 수정 | `backend/main.py` | `_HTML_ROUTES` 배열에 1줄 추가 |
| 신규 | `web/src/pages/admin/knowledge-workflow.html` | 탭 레이아웃 HTML |
| 신규 | `web/public/js/admin/knowledge-workflow.js` | KnowledgeWorkflow 상태 클래스 |
| 신규 | `web/public/css/admin/admin-knowledge-workflow.css` | 탭 바 + 공통 CSS |

---

## 4. Done Definition

- [ ] `/admin/knowledge-workflow` 접근 시 탭 UI 표시 (3개 탭 버튼)
- [ ] 탭 클릭 시 해당 패널만 표시 (다른 패널 숨김)
- [ ] URL 쿼리 `?tab=create|approval|manage` 반영
- [ ] 직접 URL 접근 시 (`?tab=approval`) 해당 탭 활성화
- [ ] 브라우저 뒤로가기로 이전 탭 복귀
- [ ] 기본 탭: `?tab=` 없으면 create
- [ ] 콘솔 에러 0건
- [ ] `knowledge-workflow.js` 200줄 이내

---

## 5. 리스크

| 리스크 | 대응 |
|--------|------|
| 탭 전환 시 기존 CSS 클래스 충돌 | `.kw-` 접두사로 네임스페이스 분리 |
| script 로딩 순서 이슈 | 기존 API -> 기존 클래스 -> 신규 탭 -> 메인 순서 보장 |

---

**문서 관리**: Phase 19-4, Task 19-4-1, 작성일 2026-02-22
