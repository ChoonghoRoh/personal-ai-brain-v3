# Phase 7.9.8: 메뉴별 상세 리뷰: 지식 구조 (Knowledge Studio)

**작성일**: 2026-01-10  
**메뉴 경로**: `/knowledge`  
**카테고리**: 사용자 메뉴

---

## 📋 개요

Knowledge Studio는 지식 청크를 라벨별로 탐색하고 관리할 수 있는 페이지입니다. 좌측 사이드바에서 라벨을 선택하면 해당 라벨이 붙은 청크들을 확인할 수 있습니다.

---

## 🎯 주요 기능

### 1. 라벨 기반 필터링
- **라벨 목록**: 모든 라벨을 사이드바에 표시
- **전체 보기**: 라벨 없이 모든 청크 표시
- **라벨 선택**: 라벨 클릭 시 해당 라벨의 청크만 필터링

### 2. 청크 목록 표시
- **청크 카드**: 각 청크를 카드 형태로 표시
- **청크 메타데이터**: 프로젝트명, 문서명, 청크 인덱스 표시
- **청크 제목**: AI 추출 또는 수동 입력된 제목 표시
- **청크 내용 미리보기**: 처음 200자 미리보기
- **라벨 배지**: 청크에 붙은 라벨 표시
- **관계 수**: 출발/도착 관계 개수 표시

### 3. 청크 상세 보기
- **청크 클릭**: 청크 카드 클릭 시 상세 페이지로 이동
- **URL 파라미터**: `document_id` 파라미터로 특정 문서의 청크만 표시

### 4. Reasoning 연동
- **Reasoning 시작**: 청크 기반 Reasoning 실행 가능 (현재는 상세 페이지에서)

---

## 🔧 기술적 구현

### 프론트엔드 구조

**파일 위치**: `web/src/pages/knowledge.html`

**주요 JavaScript 파일**:
- `web/public/js/knowledge.js`: 지식 구조 로직
- `web/public/js/header-component.js`: 헤더 컴포넌트
- `web/public/js/layout-component.js`: 레이아웃 컴포넌트
- `web/public/js/document-utils.js`: 문서 유틸리티

**주요 함수**:
- `loadLabels()`: 라벨 목록 로드
- `selectLabel()`: 라벨 선택 및 필터링
- `loadChunks()`: 청크 목록 로드
- `startReasoning()`: Reasoning 시작

### 백엔드 API

**주요 엔드포인트**:
- `GET /api/labels`: 라벨 목록 조회
- `GET /api/knowledge/chunks?label_id={id}&document_id={id}`: 청크 목록 조회

---

## ✅ 정상 작동 기능

### 1. 라벨 필터링
- ✅ 라벨 목록 정상 로드
- ✅ 전체 보기 정상 작동
- ✅ 라벨 선택 필터링 정상 작동
- ✅ 활성 라벨 하이라이팅 정상 작동

### 2. 청크 목록
- ✅ 청크 목록 정상 로드
- ✅ 청크 카드 정상 표시
- ✅ 청크 메타데이터 정상 표시
- ✅ 청크 제목 정상 표시 (AI 추출/수동 입력 구분)
- ✅ 라벨 배지 정상 표시
- ✅ 관계 수 정상 표시

### 3. 청크 상세
- ✅ 청크 클릭 시 상세 페이지 이동 정상 작동
- ✅ URL 파라미터 기반 필터링 정상 작동

### 4. 에러 처리
- ✅ 네트워크 오류 처리 정상 작동
- ✅ 빈 결과 처리 정상 작동
- ✅ 재시도 버튼 정상 작동

---

## ⚠️ 발견된 이슈

### 1. 청크 내용 XSS 취약점
**증상**: 
- 청크 내용을 HTML로 직접 삽입하여 XSS 공격 가능성
- 사용자 입력 데이터 이스케이프 처리 필요

**영향도**: 높음
**빈도**: 낮음
**상태**: 개선 필요

### 2. 청크 목록 페이징 없음
**증상**: 
- 모든 청크를 한 번에 로드하여 성능 문제 가능성
- 많은 청크가 있을 경우 로딩 시간 증가

**영향도**: 중간
**빈도**: 중간
**상태**: 개선 필요

### 3. 검색 기능 없음
**증상**: 
- 청크 내용 검색 기능이 없음
- 라벨 필터링만 가능

**영향도**: 낮음
**빈도**: 낮음
**상태**: 개선 가능

### 4. 정렬 옵션 없음
**증상**: 
- 청크 정렬 옵션이 없음 (날짜, 제목, 관계 수 등)

**영향도**: 낮음
**빈도**: 낮음
**상태**: 개선 가능

---

## 🔍 코드 품질

### 강점
- ✅ 명확한 함수 분리
- ✅ 적절한 에러 처리
- ✅ URL 파라미터 활용
- ✅ 빈 상태 처리

### 개선 가능한 부분
- ⚠️ XSS 방지 처리 필요
- ⚠️ 페이징 기능 추가 필요
- ⚠️ 검색 기능 추가 필요

---

## 📊 성능

- **라벨 로드 시간**: < 300ms
- **청크 로드 시간**: < 1초 (청크 수에 따라 변동)
- **필터링 응답**: 즉시 (클라이언트 사이드)

---

## 🎯 개선 제안

1. **XSS 방지**: 모든 사용자 입력 데이터 이스케이프 처리
2. **페이징 추가**: 청크 목록 페이징 처리
3. **검색 기능**: 청크 내용 검색 기능 추가
4. **정렬 옵션**: 날짜, 제목, 관계 수 등 정렬 옵션 추가
5. **로딩 상태 개선**: 스켈레톤 UI 또는 스피너 추가
6. **무한 스크롤**: 스크롤 시 자동 로드 기능 고려

---

## 📝 관련 파일

- `web/src/pages/knowledge.html`
- `web/public/js/knowledge.js`
- `web/public/css/knowledge.css`
- `backend/routers/knowledge.py`
- `backend/routers/labels.py`
