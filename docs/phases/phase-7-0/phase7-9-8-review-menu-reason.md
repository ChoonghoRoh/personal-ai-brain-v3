# Phase 7.9.8: 메뉴별 상세 리뷰: Reasoning Lab

**작성일**: 2026-01-10  
**메뉴 경로**: `/reason`  
**카테고리**: 사용자 메뉴

---

## 📋 개요

Reasoning Lab은 지식 기반 추론 및 방향 제안을 수행하는 페이지입니다. 프로젝트와 라벨을 필터링하여 관련 지식을 수집하고, AI를 활용하여 추론적 답변을 생성합니다.

---

## 🎯 주요 기능

### 1. Reasoning 모드 선택
- **설계/배경 설명 (Design Explain)**: 설계 의도와 배경 설명
- **리스크 분석 (Risk Review)**: 잠재적 리스크와 문제점 식별
- **다음 단계 제안 (Next Steps)**: 논리적인 다음 단계 제안
- **히스토리/맥락 추적 (History Trace)**: 지식의 진화와 맥락 추적

### 2. 필터 설정
- **프로젝트 ID**: 쉼표로 구분된 프로젝트 ID 입력
- **라벨 이름**: 쉼표로 구분된 라벨 이름 입력
- **질문/지시사항**: Reasoning에 대한 질문 또는 지시사항 입력

### 3. 결과 표시
- **결과 요약**: 참고 문서 수, 사용된 지식 청크, 발견된 관계 수
- **최종 결론**: AI가 생성한 최종 답변
- **사용된 컨텍스트**: 청크 목록 및 문서 목록 (탭 전환)
- **Reasoning 단계**: 추론 과정의 단계별 로그

### 4. Seed Chunk 지원
- **URL 파라미터**: `seed_chunk` 파라미터로 특정 청크 기반 Reasoning 시작
- **자동 입력**: Seed chunk 내용을 질문 필드에 자동 입력

---

## 🔧 기술적 구현

### 프론트엔드 구조

**파일 위치**: `web/src/pages/reason.html`

**주요 JavaScript 파일**:
- `web/public/js/reason.js`: Reasoning 로직
- `web/public/js/header-component.js`: 헤더 컴포넌트
- `web/public/js/layout-component.js`: 레이아웃 컴포넌트

**주요 함수**:
- `runReasoning()`: Reasoning 실행
- `displayResults()`: 결과 표시
- `switchContextTab()`: 컨텍스트 탭 전환
- `loadSeedChunk()`: Seed chunk 로드

### 백엔드 API

**주요 엔드포인트**:
- `POST /api/reason`: Reasoning 실행
- `GET /api/knowledge/chunks/{id}`: Seed chunk 조회

---

## ✅ 정상 작동 기능

### 1. Reasoning 실행
- ✅ 모드 선택 정상 작동
- ✅ 필터 설정 정상 작동
- ✅ 질문 입력 정상 작동
- ✅ API 호출 정상 작동

### 2. 결과 표시
- ✅ 결과 요약 정상 표시
- ✅ 최종 결론 정상 표시
- ✅ 컨텍스트 청크 목록 정상 표시
- ✅ 컨텍스트 문서 목록 정상 표시
- ✅ Reasoning 단계 정상 표시
- ✅ 탭 전환 정상 작동

### 3. Seed Chunk
- ✅ URL 파라미터 파싱 정상 작동
- ✅ Seed chunk 로드 정상 작동
- ✅ 자동 입력 정상 작동

### 4. 에러 처리
- ✅ 네트워크 오류 처리 정상 작동
- ✅ API 오류 처리 정상 작동
- ✅ 빈 결과 처리 정상 작동

---

## ⚠️ 발견된 이슈

### 1. 컨텍스트 윈도우 초과 경고
**증상**: 
- 일부 청크 내용이 너무 길어서 모델의 컨텍스트 윈도우(2048 토큰)를 초과
- `ERROR: The prompt size exceeds the context window` 오류 발생

**영향도**: 중간
**빈도**: 중간
**상태**: 개선 필요

**해결 방안**:
- 프롬프트 길이를 더 줄이기 (예: 1500자로 제한)
- 토큰 수를 직접 계산하여 제한
- 긴 청크는 여러 부분으로 나누어 처리

### 2. 결과 내용 XSS 취약점
**증상**: 
- 결과 내용을 텍스트로만 표시하지만, 향후 HTML 표시 시 XSS 위험

**영향도**: 낮음
**빈도**: 낮음
**상태**: 예방 필요

### 3. 로딩 시간 표시 부족
**증상**: 
- Reasoning 실행 시간이 길 수 있으나 진행 상태 표시 없음

**영향도**: 낮음
**빈도**: 낮음
**상태**: 개선 가능

---

## 🔍 코드 품질

### 강점
- ✅ 명확한 함수 분리
- ✅ 적절한 에러 처리
- ✅ 모드 설명 매핑
- ✅ 탭 전환 기능

### 개선 가능한 부분
- ⚠️ 컨텍스트 윈도우 초과 처리 개선 필요
- ⚠️ 진행 상태 표시 추가 필요
- ⚠️ 결과 저장/공유 기능 없음

---

## 📊 성능

- **Reasoning 실행 시간**: 10-60초 (모델 및 데이터 양에 따라 변동)
- **Seed chunk 로드**: < 300ms
- **결과 표시**: 즉시

---

## 🎯 개선 제안

1. **컨텍스트 윈도우 관리**: 토큰 수 계산 및 제한 강화
2. **진행 상태 표시**: 단계별 진행 상태 표시
3. **결과 저장**: Reasoning 결과 저장 및 히스토리 기능
4. **결과 공유**: 결과 공유 기능 추가
5. **프롬프트 최적화**: 더 효율적인 프롬프트 구조

---

## 📝 관련 파일

- `web/src/pages/reason.html`
- `web/public/js/reason.js`
- `web/public/css/reason.css`
- `backend/routers/reason.py`
