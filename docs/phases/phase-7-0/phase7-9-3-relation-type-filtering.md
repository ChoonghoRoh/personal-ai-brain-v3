# Phase 7.9.3 – 관계 타입별 필터링 기능

**작성일**: 2026-01-09  
**버전**: 7.9.3  
**상태**: 완료

---

## 0. 개요

Phase 7.9.1에서 청크 관계 매칭 보드의 기본 기능이 완성되었습니다. Phase 7.9.3에서는 관계 타입별 필터링 기능을 추가하여 사용자가 원하는 관계 타입만 선택적으로 볼 수 있도록 합니다.

### 관계 타입 목록

시스템에서 지원하는 관계 타입:
- `similar` - 유사한 관계
- `explains` - 설명하는 관계
- `result_of` - 결과 관계
- `cause_of` - 원인 관계
- `refers_to` - 참조 관계
- `evolved_from` - 진화 관계
- `risk_related_to` - 리스크 관련 관계

---

## 1. 목표

### 1.1 기능 목표

1. **기존 관계 필터링**
   - 중앙 영역의 기존 관계 카드 리스트를 관계 타입별로 필터링
   - "전체", "similar", "explains" 등 타입별 필터 버튼 제공

2. **추천 관계 필터링**
   - 우측 영역의 추천 관계 카드 리스트를 관계 타입별로 필터링
   - API에서 받은 추천 관계를 클라이언트 측에서 필터링

3. **필터 상태 유지**
   - 필터 선택 상태를 관계 매칭 보드 내에서 유지
   - 관계 연결/해제 후에도 필터 상태 유지

### 1.2 UI/UX 목표

1. **필터 UI 위치**
   - 각 영역(기존 관계, 추천 관계) 상단에 필터 버튼 그룹 추가
   - 관계 타입별 배지 색상과 일치하는 필터 버튼 스타일

2. **필터 인터랙션**
   - 클릭으로 필터 토글 (다중 선택 가능)
   - "전체" 선택 시 모든 타입 표시
   - 선택된 필터 개수 표시

---

## 2. 구현 계획

### Step 1: 필터 UI 추가

**목표**: 기존 관계 및 추천 관계 영역에 필터 버튼 그룹 추가

**작업 내용**:
1. 관계 매칭 보드 HTML에 필터 UI 추가
   - 기존 관계 영역 상단에 필터 버튼 그룹
   - 추천 관계 영역 상단에 필터 버튼 그룹
2. 필터 버튼 스타일 추가 (CSS)
   - 관계 타입별 색상 구분
   - 활성/비활성 상태 스타일
   - 다중 선택 가능한 체크박스 스타일

**예상 시간**: 30분

---

### Step 2: 필터 로직 구현

**목표**: 관계 타입별 필터링 로직 구현

**작업 내용**:
1. 필터 상태 관리
   - `window.relationTypeFilters` Set으로 선택된 필터 추적
   - "전체" 선택 시 모든 필터 해제
2. 기존 관계 필터링 함수
   - `filterExistingRelations()` 함수 구현
   - 선택된 타입에 맞는 관계만 표시
3. 추천 관계 필터링 함수
   - `filterSuggestedRelations()` 함수 구현
   - 로드된 추천 관계를 필터링하여 표시

**예상 시간**: 40분

---

### Step 3: 필터 상태 동기화

**목표**: 필터 상태를 두 영역 간 동기화

**작업 내용**:
1. 필터 변경 시 두 영역 모두 업데이트
2. 관계 연결/해제 후 필터 상태 유지
3. 청크 상세 재로드 시 필터 상태 초기화

**예상 시간**: 20분

---

## 3. 기술 스택

- **Frontend**: HTML, CSS, JavaScript (Vanilla)
- **필터링**: 클라이언트 측 필터링 (이미 로드된 데이터)

---

## 4. 파일 구조

```
web/src/pages/knowledge.html
  - 관계 매칭 보드 필터 UI 추가
  - 필터링 로직 함수 추가
  - 필터 스타일 추가
```

---

## 5. 완료 기준

### 필수 기능 (Must Have)

- [x] 기존 관계 영역에 필터 버튼 그룹 추가
- [x] 추천 관계 영역에 필터 버튼 그룹 추가
- [x] 관계 타입별 필터링 기능 구현
- [x] "전체" 선택 기능
- [x] 필터 상태 유지

### 권장 기능 (Should Have)

- [x] 관계 타입별 색상 구분
- [ ] 필터 선택 개수 표시 (선택 사항)

---

## 6. 테스트 시나리오

### 6.1 필터 기능 테스트

1. **기존 관계 필터링**
   - 관계 매칭 탭 열기
   - 기존 관계 필터에서 "similar" 선택
   - similar 타입 관계만 표시되는지 확인

2. **추천 관계 필터링**
   - 추천 관계 필터에서 "explains" 선택
   - explains 타입 추천 관계만 표시되는지 확인

3. **다중 필터 선택**
   - 여러 관계 타입 선택
   - 선택한 타입들의 관계만 표시되는지 확인

4. **전체 선택**
   - "전체" 버튼 클릭
   - 모든 관계 타입이 표시되는지 확인

5. **필터 상태 유지**
   - 필터 선택 후 관계 연결/해제
   - 필터 상태가 유지되는지 확인

---

## 7. 참고 문서

- `docs/dev/phase7-9-1-relation-matching-board.md` - Phase 7.9.1 개발 문서
- `docs/dev/phase7-7-remaining-tasks.md` - Phase 7.7 남은 작업 체크리스트
- `backend/models/models.py` - 관계 타입 정의

---

## 8. 다음 단계

Phase 7.9.3 완료 후:
- Phase 8.0: 다음 주요 기능 개발
- 또는 추가 UX 개선 작업
