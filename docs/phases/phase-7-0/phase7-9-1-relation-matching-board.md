# Phase 7.9.1 – 청크 관계 매칭 보드 완성

**작성일**: 2026-01-09  
**버전**: 7.9.1  
**상태**: 개발 중

---

## 0. 개요

Phase 7.7에서 청크 상세에 "관계 매칭" 탭의 기본 구조는 구현되었으나, 스타일링과 일부 기능이 미완성 상태입니다. Phase 7.9.1에서는 이를 완성하여 사용자가 청크 간 관계를 직관적으로 관리할 수 있도록 합니다.

### 현재 상태

- ✅ 관계 매칭 탭 기본 구조 (HTML)
- ✅ 관계 추천 API 연동 (`/api/knowledge/relations/suggest`)
- ✅ 관계 연결/해제 기능 (기본 구현)
- ❌ 관계 매칭 보드 스타일링 (CSS 미완성)
- ❌ 관계 카드 상세 스타일 및 인터랙션
- ❌ 공유 키워드/그룹 표시 기능
- ❌ 유사도 점수 시각화 개선

---

## 1. 목표

### 1.1 UI/UX 목표

1. **3단 레이아웃 완성**
   - 좌측: 기준 청크 카드 (고정, 스크롤 가능)
   - 중앙: 기존 관계 카드 리스트 (스크롤 가능)
   - 우측: AI 추천 관계 카드 리스트 (스크롤 가능)
   - 하단: 선택된 관계 요약 및 일괄 연결 버튼

2. **관계 카드 디자인**
   - 관계 타입 배지 (similar, explains, result_of 등)
   - 확정/제안 상태 표시
   - 유사도 점수 막대 그래프
   - 공유 키워드/그룹 표시 (1~3개)
   - 호버 효과 및 선택 상태 표시

3. **인터랙션 개선**
   - 카드 클릭으로 선택/해제
   - 다중 선택 시 하단 요약 표시
   - 일괄 연결 버튼 동작 개선

### 1.2 기능 목표

1. **공유 키워드/그룹 표시**
   - 추천 관계 카드에 두 청크가 공유하는 키워드/그룹 표시
   - 최대 3개까지 표시, 나머지는 "+N" 형식

2. **유사도 점수 시각화**
   - 막대 그래프로 유사도 표시
   - 색상 그라데이션 (낮음: 빨강, 높음: 초록)

3. **관계 해제 기능 개선**
   - 확정 관계는 확인 다이얼로그 표시
   - 제안 관계는 즉시 해제

---

## 2. 구현 계획

### Step 1: 관계 매칭 보드 스타일링 (CSS)

**목표**: 3단 레이아웃 및 관계 카드 기본 스타일 완성

**작업 내용**:
1. `.relation-matching-board` 컨테이너 스타일
2. `.relation-matching-layout` 그리드 레이아웃 (3단)
3. `.relation-matching-left`, `.center`, `.right` 영역 스타일
4. `.relation-card` 기본 스타일
5. `.chunk-card-preview` 스타일
6. `.relation-matching-summary` 하단 요약 영역 스타일

**예상 시간**: 30분

---

### Step 2: 관계 카드 상세 스타일 및 인터랙션

**목표**: 관계 카드의 모든 요소 스타일링 및 인터랙션 구현

**작업 내용**:
1. 관계 타입 배지 스타일 (`.relation-type-badge`)
2. 확정/제안 배지 스타일 (`.relation-confirmed-badge`, `.relation-suggested-badge`)
3. 유사도 점수 막대 그래프 스타일 (`.relation-score-bar`, `.relation-score-fill`)
4. 관계 카드 호버 효과
5. 선택 상태 스타일 (`.relation-card.selected`)
6. 버튼 스타일 (`.btn-relation`, `.btn-relation-connect`, `.btn-relation-remove`, `.btn-relation-ignore`)
7. 비활성화 상태 스타일 (`.relation-card.disabled`)

**예상 시간**: 40분

---

### Step 3: 공유 키워드/그룹 표시 기능

**목표**: 추천 관계 카드에 공유 키워드/그룹 정보 표시

**작업 내용**:
1. `loadSuggestedRelations` 함수 수정
   - 추천 관계 조회 시 기준 청크의 라벨 정보도 함께 가져오기
   - 각 추천 청크의 라벨 정보 가져오기
   - 공통 라벨 찾기 로직 추가
2. 관계 카드 HTML에 공유 키워드/그룹 표시 영역 추가
3. 공유 키워드/그룹 배지 스타일 추가
4. 최대 3개 표시, 나머지는 "+N" 형식으로 표시

**예상 시간**: 50분

---

### Step 4: 유사도 점수 시각화 개선

**목표**: 유사도 점수를 색상 그라데이션 막대 그래프로 표시

**작업 내용**:
1. 유사도 점수에 따른 색상 계산 함수 추가
   - 0.0~0.5: 빨강 계열 (#ef4444)
   - 0.5~0.7: 노랑 계열 (#f59e0b)
   - 0.7~0.9: 초록 계열 (#10b981)
   - 0.9~1.0: 진한 초록 (#059669)
2. `.relation-score-fill`에 동적 색상 적용
3. 점수 텍스트 색상도 함께 조정

**예상 시간**: 20분

---

### Step 5: 관계 해제 기능 개선 및 테스트

**목표**: 관계 해제 기능 개선 및 전체 기능 테스트

**작업 내용**:
1. `removeRelation` 함수 개선
   - 확정 관계인 경우 확인 다이얼로그 표시
   - 제안 관계는 간단한 확인만
2. 관계 해제 후 UI 업데이트 개선
3. 전체 기능 통합 테스트
   - 관계 탭 전환
   - 추천 관계 로드
   - 관계 연결 (단일/일괄)
   - 관계 해제
   - 관계 무시

**예상 시간**: 30분

---

## 3. 기술 스택

- **Frontend**: HTML, CSS, JavaScript (Vanilla)
- **Backend**: FastAPI (이미 구현됨)
- **API**: 
  - `GET /api/knowledge/chunks/{id}` - 청크 상세 조회
  - `POST /api/knowledge/relations/suggest` - 관계 추천
  - `POST /api/knowledge/relations/suggest/{chunk_id}/apply` - 관계 적용
  - `DELETE /api/relations/{id}` - 관계 삭제

---

## 4. 파일 구조

```
web/src/pages/knowledge.html
  - 관계 매칭 보드 HTML 구조 (이미 구현됨)
  - 관계 매칭 보드 CSS 스타일 (추가 필요)
  - 관계 매칭 보드 JavaScript 함수 (일부 개선 필요)
```

---

## 5. 완료 기준

### 필수 기능 (Must Have)

- [x] 관계 매칭 탭 기본 구조
- [ ] 관계 매칭 보드 3단 레이아웃 스타일 완성
- [ ] 관계 카드 기본 스타일 및 인터랙션
- [ ] 추천 관계 로드 및 표시
- [ ] 관계 연결 (단일/일괄)
- [ ] 관계 해제 기능

### 권장 기능 (Should Have)

- [ ] 공유 키워드/그룹 표시
- [ ] 유사도 점수 시각화 (색상 그라데이션)
- [ ] 관계 타입별 필터링 (선택 사항)

### 선택 기능 (Nice to Have)

- [ ] 관계 카드 드래그 앤 드롭
- [ ] 관계 타입 수정 기능
- [ ] 관계 히스토리 표시

---

## 6. 테스트 시나리오

### 6.1 기본 기능 테스트

1. **관계 탭 전환**
   - 청크 상세에서 "관계 매칭" 탭 클릭
   - 관계 매칭 보드가 정상적으로 표시되는지 확인

2. **추천 관계 로드**
   - 관계 탭으로 전환 시 추천 관계가 자동으로 로드되는지 확인
   - 추천 관계 카드가 정상적으로 표시되는지 확인

3. **관계 연결 (단일)**
   - 추천 관계 카드의 "연결" 버튼 클릭
   - 관계가 정상적으로 연결되고 UI가 업데이트되는지 확인

4. **관계 연결 (일괄)**
   - 여러 추천 관계 카드 선택
   - 하단 요약 영역이 표시되는지 확인
   - "선택한 관계 연결" 버튼 클릭
   - 모든 선택한 관계가 정상적으로 연결되는지 확인

5. **관계 해제**
   - 기존 관계 카드의 "해제" 버튼 클릭
   - 관계가 정상적으로 해제되고 UI가 업데이트되는지 확인

### 6.2 UI/UX 테스트

1. **레이아웃 반응성**
   - 브라우저 창 크기 조절 시 레이아웃이 정상적으로 유지되는지 확인

2. **카드 인터랙션**
   - 카드 호버 시 시각적 피드백 확인
   - 카드 선택 시 선택 상태 표시 확인

3. **스크롤 동작**
   - 각 영역의 스크롤이 독립적으로 동작하는지 확인

---

## 7. 참고 문서

- `docs/dev/phase7-7-remaining-tasks.md` - Phase 7.7 남은 작업 체크리스트
- `docs/dev/phase7-7-upgrade.md` - Phase 7.7 상세 설계 문서
- `backend/routers/suggestions.py` - 관계 추천 API 구현
- `web/src/pages/knowledge.html` - Knowledge Studio 페이지

---

## 8. 다음 단계

Phase 7.9.1 완료 후:
- Phase 7.9.2: 관계 매칭 보드 성능 최적화
- Phase 7.9.3: 관계 타입별 필터링 기능 추가
- Phase 8.0: 다음 주요 기능 개발
