# Phase 7.9.8: 메뉴별 상세 리뷰: AI 질의 (AI Ask)

**작성일**: 2026-01-10  
**메뉴 경로**: `/ask`  
**카테고리**: 사용자 메뉴

---

## 📋 개요

AI 질의 페이지는 Qdrant 검색 기반 컨텍스트를 제공하고, GPT4All을 활용하여 추론적 답변을 생성하는 페이지입니다.

---

## 🎯 주요 기능

### 1. 질문 입력
- **질문 입력 필드**: 사용자 질문 입력
- **컨텍스트 사용 옵션**: 컨텍스트 사용 여부 체크박스
- **Enter 키 지원**: Enter 키로 질문 제출

### 2. AI 답변 생성
- **Qdrant 검색**: 질문과 관련된 문서 검색
- **컨텍스트 제공**: 검색된 문서를 컨텍스트로 제공
- **GPT4All 활용**: AI 모델을 활용한 추론적 답변 생성
- **모델 정보 표시**: 사용된 모델 정보 표시

### 3. 참고 문서 표시
- **문서 목록**: 참고된 문서 목록 표시
- **유사도 점수**: 각 문서의 유사도 점수 표시
- **스니펫**: 관련 내용 스니펫 표시

### 4. 대화 기록
- **대화 히스토리**: 질문과 답변을 대화 형태로 기록
- **최신순 표시**: 최신 대화가 위에 표시

---

## 🔧 기술적 구현

### 프론트엔드 구조

**파일 위치**: `web/src/pages/ask.html`

**주요 JavaScript 파일**:
- `web/public/js/ask.js`: AI 질의 로직
- `web/public/js/header-component.js`: 헤더 컴포넌트
- `web/public/js/layout-component.js`: 레이아웃 컴포넌트

**주요 함수**:
- `askQuestion()`: 질문 제출 및 답변 생성

### 백엔드 API

**주요 엔드포인트**:
- `POST /api/ask`: AI 질의 실행

**요청 파라미터**:
- `question`: 질문 내용
- `context_enabled`: 컨텍스트 사용 여부
- `top_k`: 검색 결과 개수 (기본값: 5)
- `max_tokens`: 최대 토큰 수 (기본값: 500)
- `temperature`: 생성 온도 (기본값: 0.7)

---

## ✅ 정상 작동 기능

### 1. 질문 입력
- ✅ 질문 입력 필드 정상 작동
- ✅ 컨텍스트 옵션 정상 작동
- ✅ Enter 키 제출 정상 작동

### 2. AI 답변 생성
- ✅ Qdrant 검색 정상 작동
- ✅ 컨텍스트 제공 정상 작동
- ✅ GPT4All 답변 생성 정상 작동
- ✅ 모델 정보 표시 정상 작동
- ✅ 오류 메시지 표시 정상 작동

### 3. 참고 문서
- ✅ 참고 문서 목록 정상 표시
- ✅ 유사도 점수 정상 표시
- ✅ 스니펫 정상 표시

### 4. 대화 기록
- ✅ 대화 기록 저장 정상 작동
- ✅ 대화 기록 표시 정상 작동
- ✅ 최신순 정렬 정상 작동

---

## ⚠️ 발견된 이슈

### 1. 대화 기록 영구 저장 없음
**증상**: 
- 대화 기록이 메모리에만 저장되어 페이지 새로고침 시 사라짐
- 로컬 스토리지나 서버에 저장하지 않음

**영향도**: 중간
**빈도**: 높음
**상태**: 개선 필요

### 2. 답변 내용 XSS 취약점
**증상**: 
- 답변 내용을 `textContent`로 표시하여 안전하지만, 향후 HTML 표시 시 위험

**영향도**: 낮음
**빈도**: 낮음
**상태**: 예방 필요

### 3. 답변 스트리밍 없음
**증상**: 
- 답변이 완전히 생성된 후에만 표시됨
- 긴 답변의 경우 사용자 대기 시간 증가

**영향도**: 낮음
**빈도**: 낮음
**상태**: 개선 가능

### 4. 답변 재생성 없음
**증상**: 
- 같은 질문에 대해 답변을 재생성할 수 없음

**영향도**: 낮음
**빈도**: 낮음
**상태**: 개선 가능

---

## 🔍 코드 품질

### 강점
- ✅ 간단하고 명확한 코드 구조
- ✅ 적절한 에러 처리
- ✅ 모델 정보 및 오류 표시

### 개선 가능한 부분
- ⚠️ 대화 기록 영구 저장 필요
- ⚠️ 답변 스트리밍 기능 추가 가능
- ⚠️ 답변 재생성 기능 추가 가능

---

## 📊 성능

- **답변 생성 시간**: 5-30초 (모델 및 질문 길이에 따라 변동)
- **참고 문서 로드**: 즉시 (답변과 함께)
- **대화 기록 표시**: 즉시

---

## 🎯 개선 제안

1. **대화 기록 영구 저장**: 로컬 스토리지 또는 서버에 저장
2. **답변 스트리밍**: 실시간으로 답변 표시
3. **답변 재생성**: 같은 질문에 대해 답변 재생성 기능
4. **대화 내보내기**: 대화 기록 내보내기 기능
5. **대화 삭제**: 개별 대화 삭제 기능

---

## 📝 관련 파일

- `web/src/pages/ask.html`
- `web/public/js/ask.js`
- `web/public/css/ask.css`
- `backend/routers/ai.py`
