# Phase 15-8-3: 4대 추론 모드 정리

**작성일**: 2026-02-16

---

## 1. 개요

PAB 시스템의 추론(Reasoning) 엔진은 4가지 전문 모드를 제공하여, 지식 베이스에 대한 다각도 분석을 지원한다.

---

## 2. 4대 추론 모드

### 2.1 design_explain (설계 설명)

| 항목 | 내용 |
|------|------|
| **목적** | 시스템 설계·아키텍처를 Mermaid 다이어그램과 함께 설명 |
| **입력** | 프로젝트/문서 컨텍스트, 질문 |
| **출력** | 설계 설명 텍스트 + Mermaid 시각화 (flowchart, sequence) |
| **적용** | 아키텍처 리뷰, 신규 개발자 온보딩, 설계 문서화 |
| **프롬프트 전략** | 컨텍스트에서 구조적 패턴 추출 → 계층 분류 → Mermaid 생성 |

### 2.2 risk_review (리스크 검토)

| 항목 | 내용 |
|------|------|
| **목적** | 프로젝트·코드·계획의 리스크 요인 식별 및 대응 방안 제안 |
| **입력** | 프로젝트/문서 컨텍스트, 검토 범위 |
| **출력** | 리스크 목록 (심각도·확률·영향도), 대응 방안, 우선순위 |
| **적용** | 코드 리뷰, 프로젝트 계획 검증, 보안 감사 |
| **프롬프트 전략** | 패턴 매칭(보안·성능·의존성) → 규칙 기반 1차 분류 → AI 심층 분석 |

### 2.3 next_steps (후속 절차)

| 항목 | 내용 |
|------|------|
| **목적** | 현재 상태 기반 다음 단계 액션 아이템 도출 |
| **입력** | 프로젝트 상태, 완료된 작업, 미해결 이슈 |
| **출력** | 우선순위별 액션 아이템, 의존성 그래프, 타임라인 제안 |
| **적용** | 스프린트 계획, 프로젝트 진행 관리, 의사결정 지원 |
| **프롬프트 전략** | 상태 분석 → 미완료 항목 추출 → 의존성 분석 → 우선순위 정렬 |

### 2.4 history_trace (이력 추적)

| 항목 | 내용 |
|------|------|
| **목적** | 지식·문서·결정의 변경 이력 추적 및 맥락 복원 |
| **입력** | 문서/청크 ID, 시간 범위 |
| **출력** | 변경 타임라인, 각 변경의 맥락·이유, 관련 의사결정 |
| **적용** | 감사 추적, 의사결정 근거 확인, 지식 진화 분석 |
| **프롬프트 전략** | 버전 히스토리 → 변경 diff → AI 맥락 해석 → 타임라인 시각화 |

---

## 3. 검색 고도화

### 3.1 하이브리드 검색 (Sparse + Dense)

| 구성 요소 | 설명 |
|-----------|------|
| **Semantic (Dense)** | Qdrant 벡터 검색, 가중치 0.7 |
| **Keyword (Sparse)** | PostgreSQL GIN 인덱스 키워드 검색, 가중치 0.3 |
| **결합** | 정규화된 점수의 가중 합산 |

### 3.2 Re-ranking (Cross-Encoder)

| 항목 | 설정 |
|------|------|
| 모델 | `cross-encoder/ms-marco-MiniLM-L-6-v2` |
| 적용 시점 | 1차 검색 결과 상위 N건에 적용 |
| 목표 | 검색 정확도 85% → 95% |

---

## 4. Redis 캐싱 확대 (Phase 15-8-2)

| 캐시 대상 | TTL | Redis DB | 키 패턴 |
|-----------|-----|----------|---------|
| 검색 결과 | 1시간 | DB 1 | `search:{hash}` |
| 추론 결과 | 30분 | DB 1 | `reasoning:{hash}` |
| 그래프 데이터 | 10분 | DB 1 | `graph:{params}` |
| Rate Limit | - | DB 0 | `rl:{ip}:{endpoint}` |
| 토큰 블랙리스트 | Token TTL | DB 0 | `token_blacklist:{token}` |

---

## 5. Qdrant 벡터 양자화 (Phase 15-8-2)

| 항목 | 현재 | 최적화 후 |
|------|------|-----------|
| 벡터 타입 | Float32 | Scalar(Int8) |
| 메모리 사용 | 기본 | ~75% 절감 |
| 검색 정확도 | 기준 | ~1% 감소 (허용) |
| 문서 용량 | ~2.5만 | ~10만 확장 가능 |

### 설정 방법

```python
# config.py
QDRANT_QUANTIZATION_ENABLED = True
QDRANT_QUANTIZATION_TYPE = "scalar"  # 8bit 양자화
```
